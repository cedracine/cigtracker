<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<meta name="theme-color" content="#1a1a2e">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<meta name="apple-mobile-web-app-title" content="CigTracker">
<link rel="manifest" href="manifest.json">
<title>‚ò† CigTracker</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link href="https://fonts.googleapis.com/css2?family=Bebas+Neue&family=Courier+Prime:wght@400;700&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #1a1a2e;
    --accent: #ffd700;
    --text: #fff;
    --card: rgba(255,255,255,0.08);
    --card-border: rgba(255,255,255,0.15);
    --transition: 1.5s ease;
  }

  * { box-sizing: border-box; margin: 0; padding: 0; -webkit-tap-highlight-color: transparent; }

  body {
    font-family: 'Courier Prime', monospace;
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    transition: background var(--transition);
    overflow-x: hidden;
  }

  /* Animated background */
  .bg-layer {
    position: fixed; inset: 0; z-index: 0;
    background: var(--bg);
    transition: background var(--transition);
  }
  .bg-noise {
    position: fixed; inset: 0; z-index: 1; opacity: 0.04;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)'/%3E%3C/svg%3E");
    pointer-events: none;
  }

  .app {
    position: relative; z-index: 2;
    max-width: 420px; margin: 0 auto;
    padding: 0 16px 100px;
    min-height: 100vh;
  }



  /* Settings Panel */
  .settings-panel {
    position: fixed; inset: 0; z-index: 90;
    background: #0d0d1a; overflow-y: auto;
    transform: translateX(-100%); transition: transform 0.35s ease;
  }
  .settings-panel.open { transform: translateX(0); }

  .settings-section {
    background: var(--card); border: 1px solid var(--card-border);
    border-radius: 14px; padding: 16px; margin-bottom: 14px;
  }
  .settings-danger-zone { border-color: rgba(255,60,60,0.35); }
  .settings-section-title {
    font-family: 'Bebas Neue', cursive; font-size: 13px;
    letter-spacing: 3px; opacity: 0.5; margin-bottom: 12px;
  }
  .settings-label {
    font-size: 10px; letter-spacing: 1px; opacity: 0.55;
    text-transform: uppercase; margin-bottom: 4px;
  }

  /* Language tiles */
  .lang-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 7px; }
  /* Non-latin script fallback ‚Äî use system font for tiles with these langs */
  .lang-tile { font-family: 'Courier Prime', system-ui, sans-serif; }
  /* For CJK/Indic/SEA scripts, ensure system fonts render correctly */
  :lang(zh), :lang(hi), :lang(vi), :lang(th), :lang(km) { font-family: system-ui, sans-serif; }
  .lang-tile {
    background: rgba(255,255,255,0.05); border: 1px solid var(--card-border);
    color: var(--text); padding: 10px 8px; border-radius: 10px;
    font-family: 'Courier Prime', monospace; font-size: 13px;
    cursor: pointer; transition: all 0.15s; text-align: left;
  }
  .lang-tile:active { transform: scale(0.96); }
  .lang-tile.active {
    background: color-mix(in srgb, var(--accent) 20%, transparent);
    border-color: var(--accent); color: var(--accent);
  }

  /* Threshold grid */
  .threshold-grid {
    display: flex; flex-direction: column; gap: 8px;
  }
  .threshold-row {
    display: flex; align-items: center; gap: 8px;
  }
  .threshold-swatch {
    width: 14px; height: 14px; border-radius: 50%; flex-shrink: 0;
    border: 1.5px solid currentColor;
  }
  .threshold-label {
    font-size: 11px; opacity: 0.6; min-width: 120px; letter-spacing: 1px;
  }
  .threshold-input {
    background: rgba(255,255,255,0.08); border: 1px solid var(--card-border);
    color: var(--text); padding: 5px 10px; border-radius: 8px;
    font-family: 'Courier Prime', monospace; font-size: 14px;
    width: 64px; text-align: center;
  }
  .threshold-input:focus { outline: none; border-color: var(--accent); }

  /* Data buttons */
  .settings-row-btn {
    display: flex; align-items: center; gap: 10px;
    background: rgba(255,255,255,0.05); border: 1px solid var(--card-border);
    color: var(--text); padding: 12px 14px; border-radius: 10px;
    font-family: 'Courier Prime', monospace; font-size: 13px;
    cursor: pointer; width: 100%; text-align: left; margin-bottom: 8px;
    transition: all 0.15s;
  }
  .settings-row-btn:active { transform: scale(0.98); }

  /* Date range */
  .date-range-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 10px; }
  .settings-date-input {
    background: rgba(255,255,255,0.08); border: 1px solid var(--card-border);
    color: var(--text); padding: 8px 10px; border-radius: 8px;
    font-family: 'Courier Prime', monospace; font-size: 13px;
    width: 100%; color-scheme: dark;
  }
  .settings-date-input:focus { outline: none; border-color: var(--accent); }
  .delete-preview {
    font-size: 11px; opacity: 0.6; letter-spacing: 1px;
    margin-bottom: 10px; min-height: 16px;
  }

  /* Action buttons */
  .settings-btn-primary {
    flex: 1; background: var(--accent); color: #111;
    border: none; padding: 10px 16px; border-radius: 10px;
    font-family: 'Bebas Neue', cursive; font-size: 15px; letter-spacing: 2px;
    cursor: pointer; transition: all 0.15s; font-weight: 700;
  }
  .settings-btn-secondary {
    flex: 1; background: rgba(255,255,255,0.08); color: var(--text);
    border: 1px solid var(--card-border); padding: 10px 16px; border-radius: 10px;
    font-family: 'Bebas Neue', cursive; font-size: 15px; letter-spacing: 2px;
    cursor: pointer; transition: all 0.15s;
  }
  .settings-btn-danger {
    width: 100%; background: rgba(255,50,50,0.15); color: #ff6060;
    border: 1px solid rgba(255,60,60,0.4); padding: 12px 16px; border-radius: 10px;
    font-family: 'Bebas Neue', cursive; font-size: 15px; letter-spacing: 2px;
    cursor: pointer; transition: all 0.15s;
  }
  .settings-btn-danger:active { background: rgba(255,50,50,0.3); transform: scale(0.98); }

  /* Gear button */
  .gear-btn {
    background: var(--card); border: 1px solid var(--card-border);
    color: var(--text); width: 36px; height: 36px; border-radius: 50%;
    font-size: 17px; cursor: pointer; display: flex;
    align-items: center; justify-content: center;
    transition: all 0.2s; opacity: 0.7;
  }
  .gear-btn:hover { opacity: 1; }
  .gear-btn:active { transform: rotate(45deg) scale(0.9); }
  /* Header */
  header {
    display: flex; align-items: center; justify-content: space-between;
    padding: 20px 0 10px;
  }
  .logo {
    font-family: 'Bebas Neue', cursive;
    font-size: 28px; letter-spacing: 3px;
    color: var(--accent);
    text-shadow: 0 0 20px currentColor;
  }
  .stats-btn {
    background: var(--accent); border: none;
    color: #fff; padding: 10px 20px; border-radius: 20px;
    font-family: 'Bebas Neue', cursive; font-size: 16px;
    font-weight: 700; cursor: pointer; letter-spacing: 2px;
    transition: all 0.2s;
    box-shadow: 0 2px 12px color-mix(in srgb, var(--accent) 40%, transparent);
    text-shadow: 0 1px 3px rgba(0,0,0,0.4);
  }
  .stats-btn:active { transform: scale(0.95); }

  /* Avg display */
  .avg-display {
    text-align: center; padding: 16px 0 8px;
  }
  .avg-number {
    font-family: 'Bebas Neue', cursive;
    font-size: 80px; line-height: 1;
    color: var(--accent);
    text-shadow: 0 0 40px color-mix(in srgb, var(--accent) 60%, transparent);
    transition: color var(--transition), text-shadow var(--transition);
  }
  .avg-label {
    font-size: 11px; letter-spacing: 3px; opacity: 0.6;
    text-transform: uppercase; margin-top: 4px;
  }
  .avg-sublabel {
    font-size: 10px; opacity: 0.4; letter-spacing: 2px; margin-top: 2px;
  }

  /* Status bar */
  .status-bar {
    display: flex; flex-direction: column; gap: 8px; margin: 8px 0;
  }
  .status-row {
    display: grid; grid-template-columns: 1fr 1fr; gap: 8px;
  }
  .stat-card-sm {
    background: var(--card); border: 1px solid var(--card-border);
    border-radius: 12px; padding: 10px 14px; text-align: center;
  }
  .stat-card-sm .val {
    font-family: 'Bebas Neue', cursive;
    font-size: 22px; color: var(--accent);
    transition: color var(--transition);
  }
  .stat-card-sm .lbl { font-size: 9px; opacity: 0.5; letter-spacing: 1px; text-transform: uppercase; }
  /* Tendance card */
  .trend-good   { color: #4caf50 !important; }
  .trend-bad    { color: #ff5252 !important; }
  .trend-stable { color: #ff9800 !important; }
  /* Last-pack hero card */
  .hero-card {
    background: var(--card); border: 1px solid var(--accent);
    border-radius: 14px; padding: 12px 16px;
    display: flex; flex-direction: column; align-items: center; gap: 6px;
    box-shadow: 0 0 16px color-mix(in srgb, var(--accent) 20%, transparent);
    transition: border-color 1s, box-shadow 1s;
  }
  .hero-label { font-size: 9px; opacity: 0.5; letter-spacing: 2px; text-transform: uppercase; }
  .hero-main-row {
    display: flex; align-items: flex-end; justify-content: center;
    gap: 16px; width: 100%;
  }
  .hero-avg-block {
    display: flex; flex-direction: column; align-items: center;
    padding-bottom: 6px;
  }
  .hero-avg-val {
    font-family: 'Bebas Neue', cursive; font-size: 26px; line-height: 1;
    color: var(--accent); opacity: 0.75;
    transition: color 1s;
  }
  .hero-avg-lbl {
    font-size: 8px; opacity: 0.4; letter-spacing: 1px; text-transform: uppercase;
    margin-top: 2px;
  }
  .hero-number {
    font-family: 'Bebas Neue', cursive; font-size: 52px; line-height: 1;
    color: var(--accent); transition: color 1s;
    text-shadow: 0 0 24px color-mix(in srgb, var(--accent) 60%, transparent);
    animation: heroBreath 3s ease-in-out infinite;
  }
  @keyframes heroBreath {
    0%,100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.82; transform: scale(0.97); }
  }
  .hero-sublabel { font-size: 10px; opacity: 0.45; letter-spacing: 1px; }
  /* Progress bar */
  .hero-bar-wrap {
    width: 100%; height: 6px; background: rgba(255,255,255,0.1);
    border-radius: 3px; overflow: hidden;
  }
  .hero-bar {
    height: 100%; border-radius: 3px;
    background: var(--accent);
    transition: width 0.8s ease, background 1s;
    box-shadow: 0 0 8px var(--accent);
  }

  /* BIG BUTTON */
  .btn-zone {
    display: flex; justify-content: center; padding: 20px 0;
  }
  .skull-btn {
    width: 160px; height: 160px; border-radius: 50%;
    border: 3px solid var(--accent);
    background: radial-gradient(circle at 45% 38%, rgba(255,215,0,0.12), rgba(0,0,0,0.7));
    cursor: pointer; display: flex; flex-direction: column;
    align-items: center; justify-content: center;
    transition: all 0.15s;
    box-shadow: 0 0 35px color-mix(in srgb, var(--accent) 35%, transparent),
                inset 0 0 30px rgba(0,0,0,0.5);
    position: relative; overflow: hidden;
    -webkit-user-select: none; user-select: none;
  }
  .skull-btn::after {
    content: '';
    position: absolute; inset: -50%;
    background: radial-gradient(circle, rgba(255,255,255,0.1) 0%, transparent 60%);
    opacity: 0; transition: opacity 0.3s;
  }
  .skull-btn:active {
    transform: scale(0.92);
    box-shadow: 0 0 60px color-mix(in srgb, var(--accent) 60%, transparent),
                inset 0 0 40px rgba(0,0,0,0.7);
  }
  .skull-btn:active::after { opacity: 1; }
  /* skull emoji replaced by SVG */
  .skull-label {
    font-family: 'Bebas Neue', cursive;
    font-size: 13px; letter-spacing: 3px; color: var(--accent);
    margin-top: 2px; position: relative; z-index: 2;
  }

  /* Pulse animation */
  @keyframes pulse-ring {
    0% { transform: scale(1); opacity: 0.6; }
    100% { transform: scale(1.4); opacity: 0; }
  }
  .skull-btn.pulsing::before {
    content: '';
    position: absolute; inset: -10px; border-radius: 50%;
    border: 2px solid var(--accent);
    animation: pulse-ring 0.6s ease-out;
  }

  /* Pack list */
  .section-title {
    font-family: 'Bebas Neue', cursive;
    font-size: 16px; letter-spacing: 3px; opacity: 0.5;
    margin: 8px 0;
  }
  .pack-list { display: flex; flex-direction: column; gap: 6px; }
  .pack-item {
    background: var(--card); border: 1px solid var(--card-border);
    border-radius: 10px; padding: 10px 14px;
    display: flex; align-items: center; gap: 10px;
    animation: slideIn 0.3s ease;
  }
  @keyframes slideIn {
    from { opacity: 0; transform: translateY(-10px); }
    to { opacity: 1; transform: translateY(0); }
  }
  .pack-num {
    font-family: 'Bebas Neue', cursive; font-size: 20px;
    color: var(--accent); min-width: 28px;
    transition: color var(--transition);
  }
  .pack-info { flex: 1; }
  .pack-datetime { font-size: 13px; font-weight: 700; }
  .pack-delta { font-size: 10px; opacity: 0.5; margin-top: 1px; }
  .pack-actions { display: flex; gap: 6px; }
  .pack-action-btn {
    background: none; border: 1px solid var(--card-border);
    color: var(--text); width: 30px; height: 30px; border-radius: 6px;
    cursor: pointer; font-size: 14px; display: flex; align-items: center; justify-content: center;
    transition: all 0.15s;
  }
  .pack-action-btn:active { transform: scale(0.9); background: rgba(255,255,255,0.1); }
  .pack-action-btn.del { border-color: rgba(255,80,80,0.4); }
  .pack-action-btn.del:active { background: rgba(255,80,80,0.2); }

  /* Modal */
  .modal-overlay {
    position: fixed; inset: 0; z-index: 100;
    background: rgba(0,0,0,0.7); backdrop-filter: blur(8px);
    display: flex; align-items: flex-end; justify-content: center;
    opacity: 0; pointer-events: none; transition: opacity 0.3s;
  }
  .modal-overlay.open { opacity: 1; pointer-events: all; }
  .modal {
    background: #1a1a2e; border: 1px solid var(--card-border);
    border-radius: 20px 20px 0 0; padding: 24px;
    width: 100%; max-width: 420px;
    transform: translateY(100%); transition: transform 0.3s ease;
  }
  .modal-overlay.open .modal { transform: translateY(0); }
  .modal h2 {
    font-family: 'Bebas Neue', cursive; font-size: 22px;
    letter-spacing: 3px; margin-bottom: 16px; color: var(--accent);
  }
  .form-row { margin-bottom: 14px; }
  .form-row label { display: block; font-size: 11px; letter-spacing: 2px; opacity: 0.6; margin-bottom: 6px; }
  .form-row input[type="datetime-local"] {
    width: 100%; background: var(--card); border: 1px solid var(--card-border);
    color: var(--text); padding: 10px 12px; border-radius: 8px;
    font-family: 'Courier Prime', monospace; font-size: 14px;
  }
  .modal-actions { display: flex; gap: 10px; margin-top: 20px; }
  .btn-primary {
    flex: 1; background: var(--accent); color: #1a1a1a;
    border: none; padding: 12px; border-radius: 10px;
    font-family: 'Bebas Neue', cursive; font-size: 16px; letter-spacing: 2px;
    cursor: pointer; transition: all 0.15s;
  }
  .btn-primary:active { transform: scale(0.97); }
  .btn-secondary {
    flex: 1; background: var(--card); color: var(--text);
    border: 1px solid var(--card-border); padding: 12px; border-radius: 10px;
    font-family: 'Bebas Neue', cursive; font-size: 16px; letter-spacing: 2px;
    cursor: pointer; transition: all 0.15s;
  }
  .btn-secondary:active { transform: scale(0.97); }

  /* Stats panel */
  .stats-panel {
    position: fixed; inset: 0; z-index: 90;
    background: #0d0d1a; overflow-y: auto;
    transform: translateX(100%); transition: transform 0.35s ease;
  }
  .stats-panel.open { transform: translateX(0); }
  .stats-header {
    display: flex; align-items: center; gap: 12px;
    padding: 20px 16px 12px;
    border-bottom: 1px solid var(--card-border);
  }
  .back-btn {
    background: none; border: none; color: var(--accent);
    font-size: 22px; cursor: pointer; padding: 4px;
  }
  .stats-header h2 {
    font-family: 'Bebas Neue', cursive; font-size: 22px;
    letter-spacing: 3px; color: var(--accent);
  }
  .stats-content { padding: 16px; }

  /* Chart */
  .chart-section { margin: 16px 0; }
  .chart-title { font-family: 'Bebas Neue', cursive; font-size: 14px; letter-spacing: 2px; opacity: 0.5; margin-bottom: 8px; }
  .chart-wrap { position: relative; width: 100%; border-radius: 10px; overflow: hidden; background: rgba(255,255,255,0.03); touch-action: pan-y; user-select: none; }
  .chart-wrap canvas { display: block; width: 100% !important; border-radius: 10px; cursor: grab; }
  .chart-wrap canvas:active { cursor: grabbing; }
  .chart-hint { font-size: 9px; opacity: 0.3; letter-spacing: 1px; text-align: center; margin-top: 3px; }

  /* Stats grid */
  .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin: 16px 0; }
  .stat-card {
    background: var(--card); border: 1px solid var(--card-border);
    border-radius: 12px; padding: 14px;
  }
  .stat-card .big { font-family: 'Bebas Neue', cursive; font-size: 32px; color: var(--accent); transition: color var(--transition); }
  .stat-card .small { font-size: 10px; opacity: 0.5; letter-spacing: 1px; text-transform: uppercase; margin-top: 2px; }

  /* Toast */
  .toast {
    position: fixed; bottom: 20px; left: 50%; transform: translateX(-50%) translateY(100px);
    background: rgba(30,30,50,0.95); border: 1px solid var(--card-border);
    color: var(--text); padding: 12px 20px; border-radius: 30px;
    font-size: 13px; letter-spacing: 1px; z-index: 200;
    transition: transform 0.3s; white-space: nowrap;
  }
  .toast.show { transform: translateX(-50%) translateY(0); }

  /* Scrollbar */
  ::-webkit-scrollbar { width: 4px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: rgba(255,215,0,0.3); border-radius: 4px; }

  /* Bg layer transitions smoothly ‚Äî colors set via JS */
  .bg-layer { transition: background 2s ease; }

  .color-legend {
    display: flex; gap: 4px; flex-wrap: wrap; margin: 8px 0; align-items: center;
    justify-content: center;
  }
  .legend-pill {
    font-family: 'Bebas Neue', cursive;
    font-size: 12px; letter-spacing: 1px; opacity: 0.75;
    padding: 2px 8px; border-radius: 20px; border: 1.5px solid currentColor;
    line-height: 1.4;
  }
  .legend-arrow {
    font-size: 10px; opacity: 0.35; color: #fff;
  }

  .import-section { margin: 16px 0; }
  .import-btn {
    background: var(--card); border: 1px solid var(--card-border);
    color: var(--text); padding: 10px 16px; border-radius: 8px;
    font-family: 'Courier Prime', monospace; font-size: 12px;
    cursor: pointer; letter-spacing: 1px; width: 100%; text-align: left;
  }
</style>
</head>
<body>
<div class="bg-layer"></div>
<div class="bg-noise"></div>

<div class="app">
  <header>
    <div class="logo">‚ò† CIGTRACKER</div>
    <div style="display:flex;align-items:center;gap:8px;">
      <button class="gear-btn" onclick="openSettings()" title="Param√®tres">‚öô</button>
      <button class="stats-btn" id="statsBtn2" onclick="openStats()">STATS ‚ñ∏</button>
    </div>
  </header>

  <div class="avg-display">
    <div class="avg-number" id="avgNumber">‚Äì</div>
    <div class="avg-label" data-i18n="avg_label">CIG / JOUR (MOY. 3 JOURS)</div>
  </div>

  <div class="color-legend">
    <span class="legend-pill" style="border-color:#ffd700;color:#ffd700;">&lt;10</span>
    <span class="legend-pill" style="border-color:#56cfe1;color:#56cfe1;">10</span>
    <span class="legend-pill" style="border-color:#52b788;color:#52b788;">15</span>
    <span class="legend-pill" style="border-color:#a8c060;color:#a8c060;">16</span>
    <span class="legend-pill" style="border-color:#ff9800;color:#ff9800;">20</span>
    <span class="legend-pill" style="border-color:#ff6600;color:#ff6600;">21</span>
    <span class="legend-pill" style="border-color:#ff2222;color:#ff2222;">30</span>
    <span class="legend-pill" style="border-color:#aa00cc;color:#aa00cc;">31</span>
    <span class="legend-pill" style="border-color:#7b00d4;color:#7b00d4;">40+</span>
  </div>

  <div class="status-bar">
    <!-- Row 1: Tendance + Pack/30j -->
    <div class="status-row">
      <div class="stat-card-sm">
        <div class="val" id="statTrend">‚Äì</div>
        <div class="lbl" data-i18n="trend_lbl">Tendance (7j)</div>
      </div>
      <div class="stat-card-sm">
        <div class="val" id="statPPM">‚Äì</div>
        <div class="lbl" data-i18n="pack7_lbl">Pack / 7j</div>
      </div>
    </div>
    <!-- Row 2: Hero ‚Äî heures depuis dernier paquet -->
    <div class="hero-card">
      <div class="hero-label" data-i18n="hero_lbl">HEURES DEPUIS DERNIER PAQUET</div>
      <div class="hero-main-row">
        <div class="hero-number" id="statLast">‚Äì</div>
        <div class="hero-avg-block">
          <div class="hero-avg-val" id="heroAvgH7">‚Äì</div>
          <div class="hero-avg-lbl" data-i18n="avg7h_lbl">moy 7j</div>
        </div>
      </div>
      <div class="hero-bar-wrap">
        <div class="hero-bar" id="heroBar" style="width:0%"></div>
      </div>
      <div class="hero-sublabel" id="heroSublabel"></div>
    </div>
  </div>

  <div class="btn-zone" style="position:relative;z-index:1;">
    <!-- Decorative cigarettes layer ‚Äî purely visual, no touch events -->
    <svg class="cig-deco" viewBox="0 0 260 260" xmlns="http://www.w3.org/2000/svg"
         style="position:absolute;width:260px;height:260px;top:50%;left:50%;transform:translate(-50%,-50%);pointer-events:none;z-index:2;filter:drop-shadow(0 0 7px var(--accent));">
      <!-- Top-left cig: filter visible up-left, tip (braise end) 10% into skull -->
      <g transform="rotate(-38 130 130)">
        <rect x="122" y="30" width="9" height="52" rx="2.5" fill="#f0ede0" opacity="0.93"/>
        <rect x="122" y="24" width="9" height="11" rx="2.5" fill="#e07b3a"/>
        <!-- filter cap top -->
        <rect x="122" y="22" width="9" height="4" rx="1.5" fill="#c96030"/>
        <!-- braise end hidden 10% into button at bottom of this cig -->
        <circle cx="126" cy="82" r="4.5" fill="#ff5500" opacity="0.95"/>
        <circle cx="126" cy="82" r="2.5" fill="#ffcc00"/>
      </g>
      <!-- Top-right cig -->
      <g transform="rotate(38 130 130)">
        <rect x="129" y="30" width="9" height="52" rx="2.5" fill="#f0ede0" opacity="0.93"/>
        <rect x="129" y="24" width="9" height="11" rx="2.5" fill="#e07b3a"/>
        <rect x="129" y="22" width="9" height="4" rx="1.5" fill="#c96030"/>
        <circle cx="133" cy="82" r="4.5" fill="#ff5500" opacity="0.95"/>
        <circle cx="133" cy="82" r="2.5" fill="#ffcc00"/>
      </g>
      <!-- Bottom-left cig: braise end up (10% hidden into skull), filter visible below -->
      <g transform="rotate(-38 130 130)">
        <!-- paper body -->
        <rect x="122" y="178" width="9" height="52" rx="2.5" fill="#f0ede0" opacity="0.93"/>
        <!-- filter cap bottom -->
        <rect x="122" y="226" width="9" height="11" rx="2.5" fill="#e07b3a"/>
        <rect x="122" y="234" width="9" height="4" rx="1.5" fill="#c96030"/>
        <!-- braise at top, 10% into button -->
        <circle cx="126" cy="178" r="4.5" fill="#ff5500" opacity="0.95"/>
        <circle cx="126" cy="178" r="2.5" fill="#ffcc00"/>
        <!-- smoke wisps rising from braise -->
        <path d="M126 173 Q122 163 126 153 Q130 143 126 133" stroke="white" stroke-width="2" fill="none" opacity="0.28" stroke-linecap="round"/>
        <path d="M129 170 Q133 160 129 151" stroke="white" stroke-width="1.2" fill="none" opacity="0.16" stroke-linecap="round"/>
      </g>
      <!-- Bottom-right cig -->
      <g transform="rotate(38 130 130)">
        <rect x="129" y="178" width="9" height="52" rx="2.5" fill="#f0ede0" opacity="0.93"/>
        <rect x="129" y="226" width="9" height="11" rx="2.5" fill="#e07b3a"/>
        <rect x="129" y="234" width="9" height="4" rx="1.5" fill="#c96030"/>
        <circle cx="133" cy="178" r="4.5" fill="#ff5500" opacity="0.95"/>
        <circle cx="133" cy="178" r="2.5" fill="#ffcc00"/>
        <path d="M133 173 Q129 163 133 153 Q137 143 133 133" stroke="white" stroke-width="2" fill="none" opacity="0.28" stroke-linecap="round"/>
        <path d="M130 170 Q126 160 130 151" stroke="white" stroke-width="1.2" fill="none" opacity="0.16" stroke-linecap="round"/>
      </g>
    </svg>

    <!-- Actual button ‚Äî tight circle, clipped -->
    <button class="skull-btn" id="skullBtn" onclick="addPack()">
      <svg viewBox="0 0 100 110" xmlns="http://www.w3.org/2000/svg"
           style="width:100px;height:110px;pointer-events:none;">
        <!-- SKULL only, no cigarettes -->
        <ellipse cx="50" cy="46" rx="30" ry="28" fill="var(--accent)" opacity="0.93"/>
        <rect x="28" y="65" width="44" height="16" rx="5" fill="var(--accent)" opacity="0.93"/>
        <ellipse cx="38" cy="45" rx="9" ry="10" fill="#0a0a12"/>
        <ellipse cx="62" cy="45" rx="9" ry="10" fill="#0a0a12"/>
        <ellipse cx="46" cy="59" rx="4" ry="3.5" fill="#0a0a12"/>
        <ellipse cx="54" cy="59" rx="4" ry="3.5" fill="#0a0a12"/>
        <rect x="32" y="76" width="7" height="8" rx="2" fill="#0a0a12"/>
        <rect x="43" y="76" width="7" height="8" rx="2" fill="#0a0a12"/>
        <rect x="54" y="76" width="7" height="8" rx="2" fill="#0a0a12"/>
        <rect x="65" y="76" width="7" height="8" rx="2" fill="#0a0a12"/>
        <ellipse cx="40" cy="34" rx="9" ry="6" fill="white" opacity="0.12"/>
      </svg>
      <span class="skull-label" data-i18n="new_pack">NOUVEAU PAQUET</span>
    </button>
  </div>

  <div class="section-title" data-i18n="history_title">HISTORIQUE R√âCENT</div>
  <div class="pack-list" id="packList" style="position:relative;z-index:10;"></div>
</div>

<!-- Edit Modal -->
<div class="modal-overlay" id="editModal">
  <div class="modal">
    <h2 id="modalTitle">MODIFIER</h2>
    <div class="form-row">
      <label data-i18n="date_time_lbl">DATE ET HEURE</label>
      <input type="datetime-local" id="editDatetime">
    </div>
    <div class="modal-actions">
      <button class="btn-secondary" data-i18n="cancel_btn" onclick="closeModal()">ANNULER</button>
      <button class="btn-primary" data-i18n="save_btn" onclick="saveEdit()">SAUVEGARDER</button>
    </div>
  </div>
</div>

<!-- Stats Panel -->
<div class="stats-panel" id="statsPanel">
  <div class="stats-header">
    <button class="back-btn" onclick="closeStats()">‚Üê</button>
    <h2 data-i18n="stats_title">STATISTIQUES</h2>
  </div>
  <div class="stats-content">
    <div class="stats-grid">
      <div class="stat-card">
        <div class="big" id="sAvg3">‚Äì</div>
        <div class="small" data-i18n="cig3j">Cig/j (3j)</div>
      </div>
      <div class="stat-card">
        <div class="big" id="sAvg30">‚Äì</div>
        <div class="small" data-i18n="cig30j">Cig/j (30j)</div>
      </div>
      <div class="stat-card">
        <div class="big" id="sAvgH3">‚Äì</div>
        <div class="small" data-i18n="h3j">H/paquet (moy 3j)</div>
      </div>
      <div class="stat-card">
        <div class="big" id="sAvgH30">‚Äì</div>
        <div class="small" data-i18n="h30j">H/paquet (moy 30j)</div>
      </div>
    </div>
    <div class="chart-section">
      <div class="chart-title"><span data-i18n="chart1_title">CIG/JOUR ‚Äî MOY. 3J</span> <span id="chartRangeLabel" style="opacity:0.45;font-size:9px;letter-spacing:1px;font-family:'Courier Prime',monospace;"></span></div>
      <div class="chart-wrap" id="chartDailyWrap">
        <canvas id="chartDaily"></canvas>
      </div>
      <div class="chart-hint" data-i18n="swipe_hint">‚Üê glisser pour naviguer ‚Üí</div>
    </div>
    <div class="chart-section">
      <div class="chart-title" data-i18n="chart2_title">INTERVALLE ENTRE PAQUETS (heures)</div>
      <div class="chart-wrap" id="chartIntervalWrap">
        <canvas id="chartInterval"></canvas>
      </div>
      <div class="chart-hint" data-i18n="swipe_hint">‚Üê glisser pour naviguer ‚Üí</div>
    </div>

  </div>
</div>


<!-- Settings Panel -->
<div class="settings-panel" id="settingsPanel">
  <div class="stats-header">
    <button class="back-btn" onclick="closeSettings()">‚Üê</button>
    <h2 data-i18n="settings_title">PARAM√àTRES</h2>
  </div>
  <div class="stats-content">

    <!-- LANGUAGE -->
    <div class="settings-section">
      <div class="settings-section-title" data-i18n="s_lang">LANGUE</div>
      <div class="lang-grid">
        <button class="lang-tile active" id="ltile-fr" onclick="setLang('fr')">üá´üá∑ Fran√ßais</button>
        <button class="lang-tile" id="ltile-en" onclick="setLang('en')">üá¨üáß English</button>
        <button class="lang-tile" id="ltile-es" onclick="setLang('es')">üá™üá∏ Espa√±ol</button>
        <button class="lang-tile" id="ltile-de" onclick="setLang('de')">üá©üá™ Deutsch</button>
        <button class="lang-tile" id="ltile-it" onclick="setLang('it')">üáÆüáπ Italiano</button>
        <button class="lang-tile" id="ltile-pt" onclick="setLang('pt')">üáßüá∑ Portugu√™s</button>
        <button class="lang-tile" id="ltile-ru" onclick="setLang('ru')">üá∑üá∫ –†—É—Å—Å–∫–∏–π</button>
        <button class="lang-tile" id="ltile-zh" onclick="setLang('zh')">üá®üá≥ ‰∏≠Êñá</button>
        <button class="lang-tile" id="ltile-hi" onclick="setLang('hi')">üáÆüá≥ ‡§π‡§ø‡§Ç‡§¶‡•Ä</button>
        <button class="lang-tile" id="ltile-vi" onclick="setLang('vi')">üáªüá≥ Ti·∫øng Vi·ªát</button>
        <button class="lang-tile" id="ltile-th" onclick="setLang('th')">üáπüá≠ ‡∏†‡∏≤‡∏©‡∏≤‡πÑ‡∏ó‡∏¢</button>
        <button class="lang-tile" id="ltile-km" onclick="setLang('km')">üá∞üá≠ ·ûÅ·üí·ûò·üÇ·ûö</button>
      </div>
    </div>

    <!-- COLOR THRESHOLDS -->
    <div class="settings-section">
      <div class="settings-section-title" data-i18n="s_thresholds">SEUILS COULEURS (cig/jour)</div>
      <div class="threshold-grid" id="thresholdGrid">
        <!-- filled by JS -->
      </div>
      <div style="display:flex;gap:8px;margin-top:10px;">
        <button class="settings-btn-secondary" onclick="resetThresholds()" data-i18n="s_reset_thresh">‚Ü∫ D√©faut</button>
        <button class="settings-btn-primary" onclick="applyThresholds()" data-i18n="s_apply">‚úì Appliquer</button>
      </div>
    </div>

    <!-- DATA -->
    <div class="settings-section">
      <div class="settings-section-title" data-i18n="s_data">DONN√âES</div>
      <button class="settings-row-btn" onclick="exportData()">
        <span>‚¨á</span><span data-i18n="export_btn">Exporter (JSON)</span>
      </button>
      <label class="settings-row-btn" style="cursor:pointer;">
        <span>‚¨Ü</span><span data-i18n="import_btn">Importer (JSON)</span>
        <input type="file" accept=".json" style="display:none" onchange="importData(event)">
      </label>
    </div>

    <!-- DELETE DATE RANGE -->
    <div class="settings-section">
      <div class="settings-section-title" data-i18n="s_delete_range">EFFACER PLAGE DE DATES</div>
      <div class="date-range-grid">
        <div>
          <div class="settings-label" data-i18n="s_from">De</div>
          <input type="date" id="deleteFrom" class="settings-date-input">
        </div>
        <div>
          <div class="settings-label" data-i18n="s_to">√Ä</div>
          <input type="date" id="deleteTo" class="settings-date-input">
        </div>
      </div>
      <div id="deleteRangePreview" class="delete-preview"></div>
      <button class="settings-btn-danger" onclick="deleteRange()" data-i18n="s_delete_range_btn">üóë Supprimer cette plage</button>
    </div>

    <!-- FULL RESET -->
    <div class="settings-section settings-danger-zone">
      <div class="settings-section-title" data-i18n="s_danger">ZONE DE DANGER</div>
      <button class="settings-btn-danger" onclick="fullReset()" data-i18n="s_full_reset">‚ò† R√âINITIALISATION COMPL√àTE</button>
      <div class="settings-label" data-i18n="s_full_reset_hint" style="margin-top:6px;opacity:0.4;">Efface toutes les donn√©es et remet les seuils par d√©faut</div>
    </div>

  </div>
</div>

<div class="toast" id="toast"></div>

<script>

// ===================== i18n =====================
const TRANSLATIONS = {
  fr: {
    avg_label: 'CIG / JOUR (MOY. 3 JOURS)',
    trend_lbl: 'Tendance (7j)',
    pack30_lbl: 'Pack / 30j',
    pack7_lbl: 'Pack / 7j',
    avg7h_lbl: 'moy. 7j',
    hero_lbl: 'HEURES DEPUIS DERNIER PAQUET',
    new_pack: 'NOUVEAU PAQUET',
    history_title: 'HISTORIQUE R√âCENT',
    date_time_lbl: 'DATE ET HEURE',
    cancel_btn: 'ANNULER',
    save_btn: 'SAUVEGARDER',
    stats_title: 'STATISTIQUES',
    cig3j: 'Cig/j (3j)',
    cig30j: 'Cig/j (30j)',
    h3j: 'H/paquet (moy 3j)',
    h30j: 'H/paquet (moy 30j)',
    chart1_title: 'CIG/JOUR ‚Äî MOY. 3J',
    chart2_title: 'INTERVALLE ENTRE PAQUETS (heures)',
    swipe_hint: '‚Üê glisser pour naviguer ‚Üí',
    data_title: 'DONN√âES',
    export_btn: '‚¨á Exporter (JSON)',
    import_btn: '‚¨Ü Importer (JSON)',
    stats_btn: 'STATS ‚ñ∏',
    modal_edit: 'MODIFIER LE PAQUET',
    modal_add: 'NOUVEAU PAQUET',
    toast_added: 'üì¶ Paquet ajout√©',
    toast_deleted: 'üóë Paquet supprim√©',
    toast_edited: '‚úì Modifi√©',
    toast_imported: '‚úì Donn√©es import√©es',
    toast_invalid: '‚ö† Fichier invalide',
    settings_title: 'PARAM√àTRES',
    s_lang: 'LANGUE',
    s_thresholds: 'SEUILS COULEURS (cig/jour)',
    s_zone1: 'Dor√©  < seuil 1',
    s_zone2: 'Bleu‚ÜíVert  ‚â§ seuil 2',
    s_zone3: 'Vert‚ÜíOrange  ‚â§ seuil 3',
    s_zone4: 'Orange‚ÜíRouge  ‚â§ seuil 4',
    s_zone5: 'Rouge‚ÜíViolet  ‚â§ seuil 5',
    s_reset_thresh: '‚Ü∫ D√©faut',
    s_apply: '‚úì Appliquer',
    s_data: 'DONN√âES',
    s_delete_range: 'EFFACER PLAGE DE DATES',
    s_from: 'De',
    s_to: '√Ä',
    s_delete_range_btn: 'üóë Supprimer cette plage',
    s_danger: 'ZONE DE DANGER',
    s_full_reset: '‚ò† R√âINITIALISATION COMPL√àTE',
    s_full_reset_hint: 'Efface toutes les donn√©es et remet les seuils par d√©faut',
    s_invalid_range: '‚ö† Dates invalides',
    s_packs_in_range: 'paquet(s) seront supprim√©s',
    s_pick_dates: 'Choisissez une plage de dates',
    toast_thresh_saved: '‚úì Seuils sauvegard√©s',
    toast_thresh_reset: '‚Ü∫ Seuils r√©initialis√©s',
    toast_range_deleted: 'paquet(s) supprim√©(s)',
    toast_full_reset: '‚ò† Donn√©es effac√©es',
    confirm_full_reset: 'Effacer TOUTES les donn√©es et remettre les seuils par d√©faut ?',
    confirm_delete: 'Supprimer ce paquet ?',
    days: ['dim','lun','mar','mer','jeu','ven','sam'],
    months: ['jan','f√©v','mar','avr','mai','jun','jul','ao√ª','sep','oct','nov','d√©c'],
    since_prev: 'depuis le pr√©c√©dent',
    sub_less1h: "moins d'une heure",
    sub_before: (rem, ref) => `encore ${rem}h avant la moy.`,
    sub_near: (ref) => `presque √† la moyenne (${ref}h)`,
    sub_bravo: '‚úì d√©pass√© votre moyenne ‚Äî bravo !',
  },
  en: {
    avg_label: 'CIG / DAY (3-DAY AVG)',
    trend_lbl: 'Trend (7d)',
    pack30_lbl: 'Packs / 30d',
    pack7_lbl: 'Packs / 7d',
    avg7h_lbl: 'avg 7d',
    hero_lbl: 'HOURS SINCE LAST PACK',
    new_pack: 'NEW PACK',
    history_title: 'RECENT HISTORY',
    date_time_lbl: 'DATE & TIME',
    cancel_btn: 'CANCEL',
    save_btn: 'SAVE',
    stats_title: 'STATISTICS',
    cig3j: 'Cig/d (3d)',
    cig30j: 'Cig/d (30d)',
    h3j: 'H/pack (avg 3d)',
    h30j: 'H/pack (avg 30d)',
    chart1_title: 'CIG/DAY ‚Äî 3D ROLLING AVG',
    chart2_title: 'INTERVAL BETWEEN PACKS (hours)',
    swipe_hint: '‚Üê swipe to navigate ‚Üí',
    data_title: 'DATA',
    export_btn: '‚¨á Export (JSON)',
    import_btn: '‚¨Ü Import (JSON)',
    stats_btn: 'STATS ‚ñ∏',
    modal_edit: 'EDIT PACK',
    modal_add: 'NEW PACK',
    toast_added: 'üì¶ Pack added',
    toast_deleted: 'üóë Pack deleted',
    toast_edited: '‚úì Saved',
    toast_imported: '‚úì Data imported',
    toast_invalid: '‚ö† Invalid file',
    settings_title: 'SETTINGS',
    s_lang: 'LANGUAGE',
    s_thresholds: 'COLOR THRESHOLDS (cig/day)',
    s_zone1: 'Gold  < threshold 1',
    s_zone2: 'Blue‚ÜíGreen  ‚â§ threshold 2',
    s_zone3: 'Green‚ÜíOrange  ‚â§ threshold 3',
    s_zone4: 'Orange‚ÜíRed  ‚â§ threshold 4',
    s_zone5: 'Red‚ÜíPurple  ‚â§ threshold 5',
    s_reset_thresh: '‚Ü∫ Reset',
    s_apply: '‚úì Apply',
    s_data: 'DATA',
    s_delete_range: 'DELETE DATE RANGE',
    s_from: 'From',
    s_to: 'To',
    s_delete_range_btn: 'üóë Delete this range',
    s_danger: 'DANGER ZONE',
    s_full_reset: '‚ò† FULL RESET',
    s_full_reset_hint: 'Erases all data and restores default thresholds',
    s_invalid_range: '‚ö† Invalid dates',
    s_packs_in_range: 'pack(s) will be deleted',
    s_pick_dates: 'Please select a date range',
    toast_thresh_saved: '‚úì Thresholds saved',
    toast_thresh_reset: '‚Ü∫ Thresholds reset',
    toast_range_deleted: 'pack(s) deleted',
    toast_full_reset: '‚ò† Data cleared',
    confirm_full_reset: 'Erase ALL data and reset thresholds to defaults?',
    confirm_delete: 'Delete this pack?',
    days: ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'],
    months: ['Jan','Feb','Mar','Apr','May','Jun','Jul','Aug','Sep','Oct','Nov','Dec'],
    since_prev: 'since previous',
    sub_less1h: 'less than an hour',
    sub_before: (rem, ref) => `${rem}h before your average`,
    sub_near: (ref) => `almost at your average (${ref}h)`,
    sub_bravo: '‚úì beat your average ‚Äî well done!',
  },
  es: {
    avg_label: 'CIG / D√çA (PROM. 3 D√çAS)',
    trend_lbl: 'Tendencia (7d)',
    pack30_lbl: 'Cajet. / 30d',
    pack7_lbl: 'Cajet. / 7d',
    avg7h_lbl: 'prom. 7d',
    hero_lbl: 'HORAS DESDE EL √öLTIMO PAQUETE',
    new_pack: 'NUEVO PAQUETE',
    history_title: 'HISTORIAL RECIENTE',
    date_time_lbl: 'FECHA Y HORA',
    cancel_btn: 'CANCELAR',
    save_btn: 'GUARDAR',
    stats_title: 'ESTAD√çSTICAS',
    cig3j: 'Cig/d (3d)',
    cig30j: 'Cig/d (30d)',
    h3j: 'H/caj (prom 3d)',
    h30j: 'H/caj (prom 30d)',
    chart1_title: 'CIG/D√çA ‚Äî PROM. 3D',
    chart2_title: 'INTERVALO ENTRE PAQUETES (horas)',
    swipe_hint: '‚Üê deslizar para navegar ‚Üí',
    data_title: 'DATOS',
    export_btn: '‚¨á Exportar (JSON)',
    import_btn: '‚¨Ü Importar (JSON)',
    stats_btn: 'STATS ‚ñ∏',
    modal_edit: 'EDITAR PAQUETE',
    modal_add: 'NUEVO PAQUETE',
    toast_added: 'üì¶ Paquete a√±adido',
    toast_deleted: 'üóë Paquete eliminado',
    toast_edited: '‚úì Guardado',
    toast_imported: '‚úì Datos importados',
    toast_invalid: '‚ö† Archivo inv√°lido',
    settings_title: 'AJUSTES',
    s_lang: 'IDIOMA',
    s_thresholds: 'UMBRALES DE COLOR (cig/d√≠a)',
    s_zone1: 'Dorado  < umbral 1',
    s_zone2: 'Azul‚ÜíVerde  ‚â§ umbral 2',
    s_zone3: 'Verde‚ÜíNaranja  ‚â§ umbral 3',
    s_zone4: 'Naranja‚ÜíRojo  ‚â§ umbral 4',
    s_zone5: 'Rojo‚ÜíMorado  ‚â§ umbral 5',
    s_reset_thresh: '‚Ü∫ Defecto',
    s_apply: '‚úì Aplicar',
    s_data: 'DATOS',
    s_delete_range: 'ELIMINAR RANGO DE FECHAS',
    s_from: 'Desde',
    s_to: 'Hasta',
    s_delete_range_btn: 'üóë Eliminar este rango',
    s_danger: 'ZONA PELIGROSA',
    s_full_reset: '‚ò† REINICIO COMPLETO',
    s_full_reset_hint: 'Borra todos los datos y restaura los umbrales',
    s_invalid_range: '‚ö† Fechas inv√°lidas',
    s_packs_in_range: 'paquete(s) ser√°n eliminados',
    s_pick_dates: 'Elige un rango de fechas',
    toast_thresh_saved: '‚úì Umbrales guardados',
    toast_thresh_reset: '‚Ü∫ Umbrales reiniciados',
    toast_range_deleted: 'paquete(s) eliminado(s)',
    toast_full_reset: '‚ò† Datos borrados',
    confirm_full_reset: '¬øBorrar TODOS los datos y restaurar umbrales?',
    confirm_delete: '¬øEliminar este paquete?',
    days: ['dom','lun','mar','mi√©','jue','vie','s√°b'],
    months: ['ene','feb','mar','abr','may','jun','jul','ago','sep','oct','nov','dic'],
    since_prev: 'desde el anterior',
    sub_less1h: 'menos de una hora',
    sub_before: (rem, ref) => `${rem}h antes de tu promedio`,
    sub_near: (ref) => `casi en tu promedio (${ref}h)`,
    sub_bravo: '‚úì superaste tu promedio ‚Äî ¬°bravo!',
  },

  it: {
    avg_label: 'SIG / GIORNO (MEDIA 3 GG)',
    trend_lbl: 'Tendenza (7gg)',
    pack7_lbl: 'Pack / 7gg',
    pack30_lbl: 'Pack / 30gg',
    hero_lbl: "ORE DALL'ULTIMO PACCHETTO",
    avg7h_lbl: 'media 7gg',
    new_pack: 'NUOVO PACCHETTO',
    history_title: 'CRONOLOGIA RECENTE',
    date_time_lbl: 'DATA E ORA',
    cancel_btn: 'ANNULLA',
    save_btn: 'SALVA',
    stats_title: 'STATISTICHE',
    cig3j: 'Sig/g (3gg)',
    cig30j: 'Sig/g (30gg)',
    h3j: 'Ore/pack (media 3gg)',
    h30j: 'Ore/pack (media 30gg)',
    chart1_title: 'SIG/GIORNO ‚Äî MEDIA 3GG',
    chart2_title: 'INTERVALLO TRA PACCHETTI (ore)',
    swipe_hint: '‚Üê scorri per navigare ‚Üí',
    data_title: 'DATI',
    export_btn: '‚¨á Esporta (JSON)',
    import_btn: '‚¨Ü Importa (JSON)',
    stats_btn: 'STATS ‚ñ∏',
    modal_edit: 'MODIFICA PACCHETTO',
    modal_add: 'NUOVO PACCHETTO',
    toast_added: 'üì¶ Pacchetto aggiunto',
    toast_deleted: 'üóë Pacchetto eliminato',
    toast_edited: '‚úì Salvato',
    toast_imported: '‚úì Dati importati',
    toast_invalid: '‚ö† File non valido',
    confirm_delete: 'Eliminare questo pacchetto?',
    settings_title: 'IMPOSTAZIONI',
    s_lang: 'LINGUA',
    s_thresholds: 'SOGLIE COLORE (sig/giorno)',
    s_zone1: 'Oro  < soglia 1',
    s_zone2: 'Blu‚ÜíVerde  ‚â§ soglia 2',
    s_zone3: 'Verde‚ÜíArancio  ‚â§ soglia 3',
    s_zone4: 'Arancio‚ÜíRosso  ‚â§ soglia 4',
    s_zone5: 'Rosso‚ÜíViola  ‚â§ soglia 5',
    s_reset_thresh: '‚Ü∫ Default',
    s_apply: '‚úì Applica',
    s_data: 'DATI',
    s_delete_range: 'ELIMINA INTERVALLO DATE',
    s_from: 'Da',
    s_to: 'A',
    s_delete_range_btn: 'üóë Elimina questo intervallo',
    s_danger: 'ZONA PERICOLOSA',
    s_full_reset: '‚ò† RESET COMPLETO',
    s_full_reset_hint: 'Cancella tutti i dati e ripristina le soglie',
    s_invalid_range: '‚ö† Date non valide',
    s_packs_in_range: 'pacchetto/i verranno eliminati',
    s_pick_dates: 'Scegli un intervallo di date',
    toast_thresh_saved: '‚úì Soglie salvate',
    toast_thresh_reset: '‚Ü∫ Soglie reimpostate',
    toast_range_deleted: 'pacchetto/i eliminati',
    toast_full_reset: '‚ò† Dati cancellati',
    confirm_full_reset: 'Cancellare TUTTI i dati e reimpostare le soglie?',
    days: ['dom','lun','mar','mer','gio','ven','sab'],
    months: ['gen','feb','mar','apr','mag','giu','lug','ago','set','ott','nov','dic'],
    since_prev: 'dal precedente',
    sub_less1h: "meno di un'ora",
    sub_before: (rem, ref) => `ancora ${rem}h alla media`,
    sub_near: (ref) => `quasi alla media (${ref}h)`,
    sub_bravo: '‚úì superata la media ‚Äî bravo!',
  },
  pt: {
    avg_label: 'CIG / DIA (M√âDIA 3 DIAS)',
    trend_lbl: 'Tend√™ncia (7d)',
    pack7_lbl: 'Ma√ßos / 7d',
    pack30_lbl: 'Ma√ßos / 30d',
    hero_lbl: 'HORAS DESDE O √öLTIMO MA√áO',
    avg7h_lbl: 'm√©dia 7d',
    new_pack: 'NOVO MA√áO',
    history_title: 'HIST√ìRICO RECENTE',
    date_time_lbl: 'DATA E HORA',
    cancel_btn: 'CANCELAR',
    save_btn: 'SALVAR',
    stats_title: 'ESTAT√çSTICAS',
    cig3j: 'Cig/d (3d)',
    cig30j: 'Cig/d (30d)',
    h3j: 'H/ma√ßo (med 3d)',
    h30j: 'H/ma√ßo (med 30d)',
    chart1_title: 'CIG/DIA ‚Äî M√âDIA 3D',
    chart2_title: 'INTERVALO ENTRE MA√áOS (horas)',
    swipe_hint: '‚Üê deslize para navegar ‚Üí',
    data_title: 'DADOS',
    export_btn: '‚¨á Exportar (JSON)',
    import_btn: '‚¨Ü Importar (JSON)',
    stats_btn: 'STATS ‚ñ∏',
    modal_edit: 'EDITAR MA√áO',
    modal_add: 'NOVO MA√áO',
    toast_added: 'üì¶ Ma√ßo adicionado',
    toast_deleted: 'üóë Ma√ßo exclu√≠do',
    toast_edited: '‚úì Salvo',
    toast_imported: '‚úì Dados importados',
    toast_invalid: '‚ö† Arquivo inv√°lido',
    confirm_delete: 'Excluir este ma√ßo?',
    settings_title: 'CONFIGURA√á√ïES',
    s_lang: 'IDIOMA',
    s_thresholds: 'LIMITES DE COR (cig/dia)',
    s_zone1: 'Ouro  < limite 1',
    s_zone2: 'Azul‚ÜíVerde  ‚â§ limite 2',
    s_zone3: 'Verde‚ÜíLaranja  ‚â§ limite 3',
    s_zone4: 'Laranja‚ÜíVermelho  ‚â§ limite 4',
    s_zone5: 'Vermelho‚ÜíRoxo  ‚â§ limite 5',
    s_reset_thresh: '‚Ü∫ Padr√£o',
    s_apply: '‚úì Aplicar',
    s_data: 'DADOS',
    s_delete_range: 'EXCLUIR INTERVALO DE DATAS',
    s_from: 'De',
    s_to: 'At√©',
    s_delete_range_btn: 'üóë Excluir este intervalo',
    s_danger: 'ZONA DE PERIGO',
    s_full_reset: '‚ò† RESET COMPLETO',
    s_full_reset_hint: 'Apaga todos os dados e restaura os limites padr√£o',
    s_invalid_range: '‚ö† Datas inv√°lidas',
    s_packs_in_range: 'ma√ßo(s) ser√£o exclu√≠dos',
    s_pick_dates: 'Escolha um intervalo de datas',
    toast_thresh_saved: '‚úì Limites salvos',
    toast_thresh_reset: '‚Ü∫ Limites redefinidos',
    toast_range_deleted: 'ma√ßo(s) exclu√≠dos',
    toast_full_reset: '‚ò† Dados apagados',
    confirm_full_reset: 'Apagar TODOS os dados e redefinir limites?',
    days: ['dom','seg','ter','qua','qui','sex','s√°b'],
    months: ['jan','fev','mar','abr','mai','jun','jul','ago','set','out','nov','dez'],
    since_prev: 'desde o anterior',
    sub_less1h: 'menos de uma hora',
    sub_before: (rem, ref) => `${rem}h antes da m√©dia`,
    sub_near: (ref) => `quase na m√©dia (${ref}h)`,
    sub_bravo: '‚úì superou sua m√©dia ‚Äî parab√©ns!',
  },
  ru: {
    avg_label: '–°–ò–ì / –î–ï–ù–¨ (–°–†–ï–î–ù. 3 –î–ù–Ø)',
    trend_lbl: '–¢—Ä–µ–Ω–¥ (7–¥)',
    pack7_lbl: '–ü–∞—á / 7–¥',
    pack30_lbl: '–ü–∞—á / 30–¥',
    hero_lbl: '–ß–ê–°–û–í –° –ü–û–°–õ–ï–î–ù–ï–ô –ü–ê–ß–ö–ò',
    avg7h_lbl: '—Å—Ä–µ–¥–Ω. 7–¥',
    new_pack: '–ù–û–í–ê–Ø –ü–ê–ß–ö–ê',
    history_title: '–ü–û–°–õ–ï–î–ù–ò–ï –ó–ê–ü–ò–°–ò',
    date_time_lbl: '–î–ê–¢–ê –ò –í–†–ï–ú–Ø',
    cancel_btn: '–û–¢–ú–ï–ù–ê',
    save_btn: '–°–û–•–†–ê–ù–ò–¢–¨',
    stats_title: '–°–¢–ê–¢–ò–°–¢–ò–ö–ê',
    cig3j: '–°–∏–≥/–¥ (3–¥)',
    cig30j: '–°–∏–≥/–¥ (30–¥)',
    h3j: '–ß/–ø–∞—á (—Å—Ä 3–¥)',
    h30j: '–ß/–ø–∞—á (—Å—Ä 30–¥)',
    chart1_title: '–°–ò–ì/–î–ï–ù–¨ ‚Äî –°–ö–û–õ–¨–ó. 3–î',
    chart2_title: '–ò–ù–¢–ï–†–í–ê–õ –ú–ï–ñ–î–£ –ü–ê–ß–ö–ê–ú–ò (—á)',
    swipe_hint: '‚Üê —Å–≤–∞–π–ø –¥–ª—è –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ ‚Üí',
    data_title: '–î–ê–ù–ù–´–ï',
    export_btn: '‚¨á –≠–∫—Å–ø–æ—Ä—Ç (JSON)',
    import_btn: '‚¨Ü –ò–º–ø–æ—Ä—Ç (JSON)',
    stats_btn: 'STATS ‚ñ∏',
    modal_edit: '–†–ï–î–ê–ö–¢–ò–†–û–í–ê–¢–¨',
    modal_add: '–ù–û–í–ê–Ø –ü–ê–ß–ö–ê',
    toast_added: 'üì¶ –ü–∞—á–∫–∞ –¥–æ–±–∞–≤–ª–µ–Ω–∞',
    toast_deleted: 'üóë –ü–∞—á–∫–∞ —É–¥–∞–ª–µ–Ω–∞',
    toast_edited: '‚úì –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ',
    toast_imported: '‚úì –î–∞–Ω–Ω—ã–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã',
    toast_invalid: '‚ö† –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–∞–π–ª',
    confirm_delete: '–£–¥–∞–ª–∏—Ç—å —ç—Ç—É –ø–∞—á–∫—É?',
    settings_title: '–ù–ê–°–¢–†–û–ô–ö–ò',
    s_lang: '–Ø–ó–´–ö',
    s_thresholds: '–¶–í–ï–¢–û–í–´–ï –ü–û–†–û–ì–ò (—Å–∏–≥/–¥–µ–Ω—å)',
    s_zone1: '–ó–æ–ª–æ—Ç–æ  < –ø–æ—Ä–æ–≥ 1',
    s_zone2: '–°–∏–Ω–∏–π‚Üí–ó–µ–ª—ë–Ω—ã–π  ‚â§ –ø–æ—Ä–æ–≥ 2',
    s_zone3: '–ó–µ–ª—ë–Ω—ã–π‚Üí–û—Ä–∞–Ω–∂  ‚â§ –ø–æ—Ä–æ–≥ 3',
    s_zone4: '–û—Ä–∞–Ω–∂‚Üí–ö—Ä–∞—Å–Ω—ã–π  ‚â§ –ø–æ—Ä–æ–≥ 4',
    s_zone5: '–ö—Ä–∞—Å–Ω—ã–π‚Üí–§–∏–æ–ª–µ—Ç  ‚â§ –ø–æ—Ä–æ–≥ 5',
    s_reset_thresh: '‚Ü∫ –ü–æ —É–º–æ–ª—á.',
    s_apply: '‚úì –ü—Ä–∏–º–µ–Ω–∏—Ç—å',
    s_data: '–î–ê–ù–ù–´–ï',
    s_delete_range: '–£–î–ê–õ–ò–¢–¨ –î–ò–ê–ü–ê–ó–û–ù –î–ê–¢',
    s_from: '–°',
    s_to: '–ü–æ',
    s_delete_range_btn: 'üóë –£–¥–∞–ª–∏—Ç—å –¥–∏–∞–ø–∞–∑–æ–Ω',
    s_danger: '–û–ü–ê–°–ù–ê–Ø –ó–û–ù–ê',
    s_full_reset: '‚ò† –ü–û–õ–ù–´–ô –°–ë–†–û–°',
    s_full_reset_hint: '–£–¥–∞–ª—è–µ—Ç –≤—Å–µ –¥–∞–Ω–Ω—ã–µ –∏ —Å–±—Ä–∞—Å—ã–≤–∞–µ—Ç –ø–æ—Ä–æ–≥–∏',
    s_invalid_range: '‚ö† –ù–µ–≤–µ—Ä–Ω—ã–µ –¥–∞—Ç—ã',
    s_packs_in_range: '–ø–∞—á–µ–∫ –±—É–¥–µ—Ç —É–¥–∞–ª–µ–Ω–æ',
    s_pick_dates: '–í—ã–±–µ—Ä–∏—Ç–µ –¥–∏–∞–ø–∞–∑–æ–Ω –¥–∞—Ç',
    toast_thresh_saved: '‚úì –ü–æ—Ä–æ–≥–∏ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã',
    toast_thresh_reset: '‚Ü∫ –ü–æ—Ä–æ–≥–∏ —Å–±—Ä–æ—à–µ–Ω—ã',
    toast_range_deleted: '–ø–∞—á–µ–∫ —É–¥–∞–ª–µ–Ω–æ',
    toast_full_reset: '‚ò† –î–∞–Ω–Ω—ã–µ —É–¥–∞–ª–µ–Ω—ã',
    confirm_full_reset: '–£–¥–∞–ª–∏—Ç—å –í–°–ï –¥–∞–Ω–Ω—ã–µ –∏ —Å–±—Ä–æ—Å–∏—Ç—å –ø–æ—Ä–æ–≥–∏?',
    days: ['–≤—Å','–ø–Ω','–≤—Ç','—Å—Ä','—á—Ç','–ø—Ç','—Å–±'],
    months: ['—è–Ω–≤','—Ñ–µ–≤','–º–∞—Ä','–∞–ø—Ä','–º–∞–π','–∏—é–Ω','–∏—é–ª','–∞–≤–≥','—Å–µ–Ω','–æ–∫—Ç','–Ω–æ—è','–¥–µ–∫'],
    since_prev: '—Å –ø—Ä–µ–¥—ã–¥—É—â–µ–π',
    sub_less1h: '–º–µ–Ω–µ–µ —á–∞—Å–∞',
    sub_before: (rem, ref) => `–µ—â—ë ${rem}—á –¥–æ —Å—Ä–µ–¥–Ω–µ–≥–æ`,
    sub_near: (ref) => `–ø–æ—á—Ç–∏ —Å—Ä–µ–¥–Ω–µ–µ (${ref}—á)`,
    sub_bravo: '‚úì –ø—Ä–µ–≤—ã—Å–∏–ª–∏ —Å—Ä–µ–¥–Ω–µ–µ ‚Äî –æ—Ç–ª–∏—á–Ω–æ!',
  },
  zh: {
    avg_label: 'ÁÉüÊîØ/Â§©Ôºà3Â§©ÂùáÂÄºÔºâ',
    trend_lbl: 'Ë∂ãÂäøÔºà7Â§©Ôºâ',
    pack7_lbl: 'ÂåÖ / 7Â§©',
    pack30_lbl: 'ÂåÖ / 30Â§©',
    hero_lbl: 'Ë∑ù‰∏äÊ¨°ÂºÄÂåÖÁöÑÂ∞èÊó∂Êï∞',
    avg7h_lbl: '7Â§©ÂùáÂÄº',
    new_pack: 'Êñ∞ÂåÖ',
    history_title: 'ÊúÄËøëËÆ∞ÂΩï',
    date_time_lbl: 'Êó•Êúü‰∏éÊó∂Èó¥',
    cancel_btn: 'ÂèñÊ∂à',
    save_btn: '‰øùÂ≠ò',
    stats_title: 'ÁªüËÆ°',
    cig3j: 'ÊîØ/Â§©Ôºà3Â§©Ôºâ',
    cig30j: 'ÊîØ/Â§©Ôºà30Â§©Ôºâ',
    h3j: 'Â∞èÊó∂/ÂåÖÔºà3Â§©ÂùáÔºâ',
    h30j: 'Â∞èÊó∂/ÂåÖÔºà30Â§©ÂùáÔºâ',
    chart1_title: 'ÊîØ/Â§© ‚Äî 3Â§©ÊªöÂä®ÂùáÂÄº',
    chart2_title: 'ÂåÖÈó¥ÈöîÊó∂Èó¥ÔºàÂ∞èÊó∂Ôºâ',
    swipe_hint: '‚Üê ÊªëÂä®ÊµèËßà ‚Üí',
    data_title: 'Êï∞ÊçÆ',
    export_btn: '‚¨á ÂØºÂá∫ (JSON)',
    import_btn: '‚¨Ü ÂØºÂÖ• (JSON)',
    stats_btn: 'STATS ‚ñ∏',
    modal_edit: 'ÁºñËæëËÆ∞ÂΩï',
    modal_add: 'Êñ∞ÂåÖ',
    toast_added: 'üì¶ Â∑≤Ê∑ªÂä†',
    toast_deleted: 'üóë Â∑≤Âà†Èô§',
    toast_edited: '‚úì Â∑≤‰øùÂ≠ò',
    toast_imported: '‚úì Êï∞ÊçÆÂ∑≤ÂØºÂÖ•',
    toast_invalid: '‚ö† Êñá‰ª∂Êó†Êïà',
    confirm_delete: 'Âà†Èô§ËøôÂåÖËÆ∞ÂΩïÔºü',
    settings_title: 'ËÆæÁΩÆ',
    s_lang: 'ËØ≠Ë®Ä',
    s_thresholds: 'È¢úËâ≤ÈòàÂÄºÔºàÊîØ/Â§©Ôºâ',
    s_zone1: 'ÈáëËâ≤  < ÈòàÂÄº1',
    s_zone2: 'Ëìù‚ÜíÁªø  ‚â§ ÈòàÂÄº2',
    s_zone3: 'Áªø‚ÜíÊ©ô  ‚â§ ÈòàÂÄº3',
    s_zone4: 'Ê©ô‚ÜíÁ∫¢  ‚â§ ÈòàÂÄº4',
    s_zone5: 'Á∫¢‚ÜíÁ¥´  ‚â§ ÈòàÂÄº5',
    s_reset_thresh: '‚Ü∫ ÈªòËÆ§',
    s_apply: '‚úì Â∫îÁî®',
    s_data: 'Êï∞ÊçÆ',
    s_delete_range: 'Âà†Èô§Êó•ÊúüËåÉÂõ¥',
    s_from: '‰ªé',
    s_to: 'Ëá≥',
    s_delete_range_btn: 'üóë Âà†Èô§Ê≠§ËåÉÂõ¥',
    s_danger: 'Âç±Èô©Âå∫',
    s_full_reset: '‚ò† ÂÆåÂÖ®ÈáçÁΩÆ',
    s_full_reset_hint: 'Ê∏ÖÈô§ÊâÄÊúâÊï∞ÊçÆÂπ∂ÊÅ¢Â§çÈªòËÆ§ÈòàÂÄº',
    s_invalid_range: '‚ö† Êó•ÊúüÊó†Êïà',
    s_packs_in_range: 'ÂåÖÂ∞ÜË¢´Âà†Èô§',
    s_pick_dates: 'ËØ∑ÈÄâÊã©Êó•ÊúüËåÉÂõ¥',
    toast_thresh_saved: '‚úì ÈòàÂÄºÂ∑≤‰øùÂ≠ò',
    toast_thresh_reset: '‚Ü∫ ÈòàÂÄºÂ∑≤ÈáçÁΩÆ',
    toast_range_deleted: 'ÂåÖÂ∑≤Âà†Èô§',
    toast_full_reset: '‚ò† Êï∞ÊçÆÂ∑≤Ê∏ÖÈô§',
    confirm_full_reset: 'Ê∏ÖÈô§ÊâÄÊúâÊï∞ÊçÆÂπ∂ÈáçÁΩÆÈòàÂÄºÔºü',
    days: ['Êó•','‰∏Ä','‰∫å','‰∏â','Âõõ','‰∫î','ÂÖ≠'],
    months: ['1Êúà','2Êúà','3Êúà','4Êúà','5Êúà','6Êúà','7Êúà','8Êúà','9Êúà','10Êúà','11Êúà','12Êúà'],
    since_prev: 'Ë∑ù‰∏äÊ¨°',
    sub_less1h: '‰∏çË∂≥‰∏ÄÂ∞èÊó∂',
    sub_before: (rem, ref) => `ËøòÊúâ${rem}Â∞èÊó∂Âà∞ÂùáÂÄº`,
    sub_near: (ref) => `Êé•ËøëÂùáÂÄºÔºà${ref}Â∞èÊó∂Ôºâ`,
    sub_bravo: '‚úì Ë∂ÖËøáÂùáÂÄº ‚Äî ÂæàÂ•ΩÔºÅ',
  },
  hi: {
    avg_label: '‡§∏‡§ø‡§ó / ‡§¶‡§ø‡§® (3 ‡§¶‡§ø‡§® ‡§î‡§∏‡§§)',
    trend_lbl: '‡§∞‡•Å‡§ù‡§æ‡§® (7‡§¶‡§ø‡§®)',
    pack7_lbl: '‡§™‡•à‡§ï / 7‡§¶‡§ø‡§®',
    pack30_lbl: '‡§™‡•à‡§ï / 30‡§¶‡§ø‡§®',
    hero_lbl: '‡§Ö‡§Ç‡§§‡§ø‡§Æ ‡§™‡•à‡§ï ‡§ï‡•á ‡§¨‡§æ‡§¶ ‡§ò‡§Ç‡§ü‡•á',
    avg7h_lbl: '7‡§¶‡§ø‡§® ‡§î‡§∏‡§§',
    new_pack: '‡§®‡§Ø‡§æ ‡§™‡•à‡§ï',
    history_title: '‡§π‡§æ‡§≤‡§ø‡§Ø‡§æ ‡§á‡§§‡§ø‡§π‡§æ‡§∏',
    date_time_lbl: '‡§¶‡§ø‡§®‡§æ‡§Ç‡§ï ‡§î‡§∞ ‡§∏‡§Æ‡§Ø',
    cancel_btn: '‡§∞‡§¶‡•ç‡§¶ ‡§ï‡§∞‡•á‡§Ç',
    save_btn: '‡§∏‡§π‡•á‡§ú‡•á‡§Ç',
    stats_title: '‡§∏‡§æ‡§Ç‡§ñ‡•ç‡§Ø‡§ø‡§ï‡•Ä',
    cig3j: '‡§∏‡§ø‡§ó/‡§¶‡§ø‡§® (3‡§¶‡§ø‡§®)',
    cig30j: '‡§∏‡§ø‡§ó/‡§¶‡§ø‡§® (30‡§¶‡§ø‡§®)',
    h3j: '‡§ò‡§Ç/‡§™‡•à‡§ï (3‡§¶‡§ø‡§®)',
    h30j: '‡§ò‡§Ç/‡§™‡•à‡§ï (30‡§¶‡§ø‡§®)',
    chart1_title: '‡§∏‡§ø‡§ó/‡§¶‡§ø‡§® ‚Äî 3‡§¶‡§ø‡§® ‡§∞‡•ã‡§≤‡§ø‡§Ç‡§ó',
    chart2_title: '‡§™‡•à‡§ï ‡§ï‡•á ‡§¨‡•Ä‡§ö ‡§Ö‡§Ç‡§§‡§∞‡§æ‡§≤ (‡§ò‡§Ç‡§ü‡•á)',
    swipe_hint: '‚Üê ‡§®‡•á‡§µ‡§ø‡§ó‡•á‡§ü ‡§ï‡§∞‡§®‡•á ‡§ï‡•á ‡§≤‡§ø‡§è ‡§∏‡•ç‡§µ‡§æ‡§á‡§™ ‡§ï‡§∞‡•á‡§Ç ‚Üí',
    data_title: '‡§°‡•á‡§ü‡§æ',
    export_btn: '‚¨á ‡§®‡§ø‡§∞‡•ç‡§Ø‡§æ‡§§ (JSON)',
    import_btn: '‚¨Ü ‡§Ü‡§Ø‡§æ‡§§ (JSON)',
    stats_btn: 'STATS ‚ñ∏',
    modal_edit: '‡§™‡•à‡§ï ‡§∏‡§Ç‡§™‡§æ‡§¶‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç',
    modal_add: '‡§®‡§Ø‡§æ ‡§™‡•à‡§ï',
    toast_added: 'üì¶ ‡§™‡•à‡§ï ‡§ú‡•ã‡§°‡§º‡§æ ‡§ó‡§Ø‡§æ',
    toast_deleted: 'üóë ‡§™‡•à‡§ï ‡§π‡§ü‡§æ‡§Ø‡§æ ‡§ó‡§Ø‡§æ',
    toast_edited: '‚úì ‡§∏‡§π‡•á‡§ú‡§æ ‡§ó‡§Ø‡§æ',
    toast_imported: '‚úì ‡§°‡•á‡§ü‡§æ ‡§Ü‡§Ø‡§æ‡§§ ‡§π‡•Å‡§Ü',
    toast_invalid: '‚ö† ‡§Ö‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§´‡§º‡§æ‡§á‡§≤',
    confirm_delete: '‡§á‡§∏ ‡§™‡•à‡§ï ‡§ï‡•ã ‡§π‡§ü‡§æ‡§è‡§Ç?',
    settings_title: '‡§∏‡•á‡§ü‡§ø‡§Ç‡§ó‡•ç‡§∏',
    s_lang: '‡§≠‡§æ‡§∑‡§æ',
    s_thresholds: '‡§∞‡§Ç‡§ó ‡§∏‡•Ä‡§Æ‡§æ‡§è‡§Ç (‡§∏‡§ø‡§ó/‡§¶‡§ø‡§®)',
    s_zone1: '‡§∏‡•ã‡§®‡§æ  < ‡§∏‡•Ä‡§Æ‡§æ 1',
    s_zone2: '‡§®‡•Ä‡§≤‡§æ‚Üí‡§π‡§∞‡§æ  ‚â§ ‡§∏‡•Ä‡§Æ‡§æ 2',
    s_zone3: '‡§π‡§∞‡§æ‚Üí‡§®‡§æ‡§∞‡§Ç‡§ó‡•Ä  ‚â§ ‡§∏‡•Ä‡§Æ‡§æ 3',
    s_zone4: '‡§®‡§æ‡§∞‡§Ç‡§ó‡•Ä‚Üí‡§≤‡§æ‡§≤  ‚â§ ‡§∏‡•Ä‡§Æ‡§æ 4',
    s_zone5: '‡§≤‡§æ‡§≤‚Üí‡§¨‡•à‡§Ç‡§ó‡§®‡•Ä  ‚â§ ‡§∏‡•Ä‡§Æ‡§æ 5',
    s_reset_thresh: '‚Ü∫ ‡§°‡§ø‡§´‡§º‡•â‡§≤‡•ç‡§ü',
    s_apply: '‚úì ‡§≤‡§æ‡§ó‡•Ç ‡§ï‡§∞‡•á‡§Ç',
    s_data: '‡§°‡•á‡§ü‡§æ',
    s_delete_range: '‡§§‡§ø‡§•‡§ø ‡§∏‡•Ä‡§Æ‡§æ ‡§π‡§ü‡§æ‡§è‡§Ç',
    s_from: '‡§∏‡•á',
    s_to: '‡§§‡§ï',
    s_delete_range_btn: 'üóë ‡§Ø‡§π ‡§∏‡•Ä‡§Æ‡§æ ‡§π‡§ü‡§æ‡§è‡§Ç',
    s_danger: '‡§ñ‡§§‡§∞‡•á ‡§ï‡§æ ‡§ï‡•ç‡§∑‡•á‡§§‡•ç‡§∞',
    s_full_reset: '‚ò† ‡§™‡•Ç‡§∞‡•ç‡§£ ‡§∞‡•Ä‡§∏‡•á‡§ü',
    s_full_reset_hint: '‡§∏‡§≠‡•Ä ‡§°‡•á‡§ü‡§æ ‡§Æ‡§ø‡§ü‡§æ‡§è‡§Ç ‡§î‡§∞ ‡§°‡§ø‡§´‡§º‡•â‡§≤‡•ç‡§ü ‡§∏‡•Ä‡§Æ‡§æ‡§è‡§Ç ‡§™‡•Å‡§®‡§∞‡•ç‡§∏‡•ç‡§•‡§æ‡§™‡§ø‡§§ ‡§ï‡§∞‡•á‡§Ç',
    s_invalid_range: '‚ö† ‡§Ö‡§Æ‡§æ‡§®‡•ç‡§Ø ‡§§‡§ø‡§•‡§ø‡§Ø‡§æ‡§Ç',
    s_packs_in_range: '‡§™‡•à‡§ï ‡§π‡§ü‡§æ‡§è ‡§ú‡§æ‡§è‡§Ç‡§ó‡•á',
    s_pick_dates: '‡§ï‡•É‡§™‡§Ø‡§æ ‡§§‡§ø‡§•‡§ø ‡§∏‡•Ä‡§Æ‡§æ ‡§ö‡•Å‡§®‡•á‡§Ç',
    toast_thresh_saved: '‚úì ‡§∏‡•Ä‡§Æ‡§æ‡§è‡§Ç ‡§∏‡§π‡•á‡§ú‡•Ä ‡§ó‡§à‡§Ç',
    toast_thresh_reset: '‚Ü∫ ‡§∏‡•Ä‡§Æ‡§æ‡§è‡§Ç ‡§∞‡•Ä‡§∏‡•á‡§ü ‡§π‡•Å‡§à‡§Ç',
    toast_range_deleted: '‡§™‡•à‡§ï ‡§π‡§ü‡§æ‡§è ‡§ó‡§è',
    toast_full_reset: '‚ò† ‡§°‡•á‡§ü‡§æ ‡§Æ‡§ø‡§ü‡§æ‡§Ø‡§æ ‡§ó‡§Ø‡§æ',
    confirm_full_reset: '‡§∏‡§≠‡•Ä ‡§°‡•á‡§ü‡§æ ‡§Æ‡§ø‡§ü‡§æ‡§è‡§Ç ‡§î‡§∞ ‡§∏‡•Ä‡§Æ‡§æ‡§è‡§Ç ‡§∞‡•Ä‡§∏‡•á‡§ü ‡§ï‡§∞‡•á‡§Ç?',
    days: ['‡§∞‡§µ‡§ø','‡§∏‡•ã‡§Æ','‡§Æ‡§Ç‡§ó‡§≤','‡§¨‡•Å‡§ß','‡§ó‡•Å‡§∞‡•Å','‡§∂‡•Å‡§ï‡•ç‡§∞','‡§∂‡§®‡§ø'],
    months: ['‡§ú‡§®','‡§´‡§∞','‡§Æ‡§æ‡§∞','‡§Ö‡§™‡•ç‡§∞','‡§Æ‡§à','‡§ú‡•Ç‡§®','‡§ú‡•Å‡§≤','‡§Ö‡§ó','‡§∏‡§ø‡§§','‡§Ö‡§ï‡•ç‡§§','‡§®‡§µ','‡§¶‡§ø‡§∏'],
    since_prev: '‡§™‡§ø‡§õ‡§≤‡•á ‡§ï‡•á ‡§¨‡§æ‡§¶',
    sub_less1h: '‡§è‡§ï ‡§ò‡§Ç‡§ü‡•á ‡§∏‡•á ‡§ï‡§Æ',
    sub_before: (rem, ref) => `‡§î‡§∏‡§§ ‡§∏‡•á ${rem}‡§ò‡§Ç ‡§™‡§π‡§≤‡•á`,
    sub_near: (ref) => `‡§î‡§∏‡§§ ‡§ï‡•á ‡§ï‡§∞‡•Ä‡§¨ (${ref}‡§ò‡§Ç)`,
    sub_bravo: '‚úì ‡§î‡§∏‡§§ ‡§™‡§æ‡§∞ ‡§ï‡§ø‡§Ø‡§æ ‚Äî ‡§∂‡§æ‡§¨‡§æ‡§∂!',
  },
  vi: {
    avg_label: 'ƒêI·∫æU / NG√ÄY (TB 3 NG√ÄY)',
    trend_lbl: 'Xu h∆∞·ªõng (7ng)',
    pack7_lbl: 'G√≥i / 7ng',
    pack30_lbl: 'G√≥i / 30ng',
    hero_lbl: 'GI·ªú K·ªÇ T·ª™ G√ìI CU·ªêI',
    avg7h_lbl: 'tb 7 ng√†y',
    new_pack: 'G√ìI M·ªöI',
    history_title: 'L·ªäCH S·ª¨ G·∫¶N ƒê√ÇY',
    date_time_lbl: 'NG√ÄY V√Ä GI·ªú',
    cancel_btn: 'H·ª¶Y',
    save_btn: 'L∆ØU',
    stats_title: 'TH·ªêNG K√ä',
    cig3j: 'ƒêi·∫øu/ng (3ng)',
    cig30j: 'ƒêi·∫øu/ng (30ng)',
    h3j: 'Gi·ªù/g√≥i (tb 3ng)',
    h30j: 'Gi·ªù/g√≥i (tb 30ng)',
    chart1_title: 'ƒêI·∫æU/NG√ÄY ‚Äî TB 3 NG√ÄY',
    chart2_title: 'KHO·∫¢NG C√ÅCH GI·ªÆA C√ÅC G√ìI (gi·ªù)',
    swipe_hint: '‚Üê vu·ªët ƒë·ªÉ ƒëi·ªÅu h∆∞·ªõng ‚Üí',
    data_title: 'D·ªÆ LI·ªÜU',
    export_btn: '‚¨á Xu·∫•t (JSON)',
    import_btn: '‚¨Ü Nh·∫≠p (JSON)',
    stats_btn: 'STATS ‚ñ∏',
    modal_edit: 'S·ª¨A G√ìI',
    modal_add: 'G√ìI M·ªöI',
    toast_added: 'üì¶ ƒê√£ th√™m g√≥i',
    toast_deleted: 'üóë ƒê√£ x√≥a g√≥i',
    toast_edited: '‚úì ƒê√£ l∆∞u',
    toast_imported: '‚úì ƒê√£ nh·∫≠p d·ªØ li·ªáu',
    toast_invalid: '‚ö† T·ªáp kh√¥ng h·ª£p l·ªá',
    confirm_delete: 'X√≥a g√≥i n√†y?',
    settings_title: 'C√ÄI ƒê·∫∂T',
    s_lang: 'NG√îN NG·ªÆ',
    s_thresholds: 'NG∆Ø·ª†NG M√ÄU (ƒëi·∫øu/ng√†y)',
    s_zone1: 'V√†ng  < ng∆∞·ª°ng 1',
    s_zone2: 'Xanh d∆∞∆°ng‚ÜíXanh l√°  ‚â§ ng∆∞·ª°ng 2',
    s_zone3: 'Xanh l√°‚ÜíCam  ‚â§ ng∆∞·ª°ng 3',
    s_zone4: 'Cam‚Üíƒê·ªè  ‚â§ ng∆∞·ª°ng 4',
    s_zone5: 'ƒê·ªè‚ÜíT√≠m  ‚â§ ng∆∞·ª°ng 5',
    s_reset_thresh: '‚Ü∫ M·∫∑c ƒë·ªãnh',
    s_apply: '‚úì √Åp d·ª•ng',
    s_data: 'D·ªÆ LI·ªÜU',
    s_delete_range: 'X√ìA KHO·∫¢NG NG√ÄY',
    s_from: 'T·ª´',
    s_to: 'ƒê·∫øn',
    s_delete_range_btn: 'üóë X√≥a kho·∫£ng n√†y',
    s_danger: 'V√ôNG NGUY HI·ªÇM',
    s_full_reset: '‚ò† ƒê·∫∂T L·∫†I HO√ÄN TO√ÄN',
    s_full_reset_hint: 'X√≥a t·∫•t c·∫£ d·ªØ li·ªáu v√† kh√¥i ph·ª•c ng∆∞·ª°ng m·∫∑c ƒë·ªãnh',
    s_invalid_range: '‚ö† Ng√†y kh√¥ng h·ª£p l·ªá',
    s_packs_in_range: 'g√≥i s·∫Ω b·ªã x√≥a',
    s_pick_dates: 'Vui l√≤ng ch·ªçn kho·∫£ng ng√†y',
    toast_thresh_saved: '‚úì ƒê√£ l∆∞u ng∆∞·ª°ng',
    toast_thresh_reset: '‚Ü∫ ƒê√£ ƒë·∫∑t l·∫°i ng∆∞·ª°ng',
    toast_range_deleted: 'g√≥i ƒë√£ x√≥a',
    toast_full_reset: '‚ò† ƒê√£ x√≥a d·ªØ li·ªáu',
    confirm_full_reset: 'X√≥a T·∫§T C·∫¢ d·ªØ li·ªáu v√† ƒë·∫∑t l·∫°i ng∆∞·ª°ng?',
    days: ['CN','T2','T3','T4','T5','T6','T7'],
    months: ['Th1','Th2','Th3','Th4','Th5','Th6','Th7','Th8','Th9','Th10','Th11','Th12'],
    since_prev: 'k·ªÉ t·ª´ g√≥i tr∆∞·ªõc',
    sub_less1h: 'ch∆∞a ƒë·∫øn m·ªôt gi·ªù',
    sub_before: (rem, ref) => `c√≤n ${rem}g tr∆∞·ªõc m·ª©c trung b√¨nh`,
    sub_near: (ref) => `g·∫ßn m·ª©c trung b√¨nh (${ref}g)`,
    sub_bravo: '‚úì v∆∞·ª£t m·ª©c trung b√¨nh ‚Äî xu·∫•t s·∫Øc!',
  },
  th: {
    avg_label: '‡∏°‡∏ß‡∏ô/‡∏ß‡∏±‡∏ô (‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ 3 ‡∏ß‡∏±‡∏ô)',
    trend_lbl: '‡πÅ‡∏ô‡∏ß‡πÇ‡∏ô‡πâ‡∏° (7‡∏ß)',
    pack7_lbl: '‡∏ã‡∏≠‡∏á / 7‡∏ß',
    pack30_lbl: '‡∏ã‡∏≠‡∏á / 30‡∏ß',
    hero_lbl: '‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á‡∏ô‡∏±‡∏ö‡∏à‡∏≤‡∏Å‡∏ã‡∏≠‡∏á‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î',
    avg7h_lbl: '‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ 7‡∏ß',
    new_pack: '‡∏ã‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà',
    history_title: '‡∏õ‡∏£‡∏∞‡∏ß‡∏±‡∏ï‡∏¥‡∏•‡πà‡∏≤‡∏™‡∏∏‡∏î',
    date_time_lbl: '‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÅ‡∏•‡∏∞‡πÄ‡∏ß‡∏•‡∏≤',
    cancel_btn: '‡∏¢‡∏Å‡πÄ‡∏•‡∏¥‡∏Å',
    save_btn: '‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å',
    stats_title: '‡∏™‡∏ñ‡∏¥‡∏ï‡∏¥',
    cig3j: '‡∏°‡∏ß‡∏ô/‡∏ß (3‡∏ß)',
    cig30j: '‡∏°‡∏ß‡∏ô/‡∏ß (30‡∏ß)',
    h3j: '‡∏ä‡∏°/‡∏ã‡∏≠‡∏á (‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ 3‡∏ß)',
    h30j: '‡∏ä‡∏°/‡∏ã‡∏≠‡∏á (‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ 30‡∏ß)',
    chart1_title: '‡∏°‡∏ß‡∏ô/‡∏ß‡∏±‡∏ô ‚Äî ‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢‡πÄ‡∏Ñ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡∏ó‡∏µ‡πà 3‡∏ß',
    chart2_title: '‡∏ä‡πà‡∏ß‡∏á‡πÄ‡∏ß‡∏•‡∏≤‡∏£‡∏∞‡∏´‡∏ß‡πà‡∏≤‡∏á‡∏ã‡∏≠‡∏á (‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á)',
    swipe_hint: '‚Üê ‡πÄ‡∏•‡∏∑‡πà‡∏≠‡∏ô‡πÄ‡∏û‡∏∑‡πà‡∏≠‡∏ô‡∏≥‡∏ó‡∏≤‡∏á ‚Üí',
    data_title: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
    export_btn: '‚¨á ‡∏™‡πà‡∏á‡∏≠‡∏≠‡∏Å (JSON)',
    import_btn: '‚¨Ü ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤ (JSON)',
    stats_btn: 'STATS ‚ñ∏',
    modal_edit: '‡πÅ‡∏Å‡πâ‡πÑ‡∏Ç‡∏ã‡∏≠‡∏á',
    modal_add: '‡∏ã‡∏≠‡∏á‡πÉ‡∏´‡∏°‡πà',
    toast_added: 'üì¶ ‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏ã‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß',
    toast_deleted: 'üóë ‡∏•‡∏ö‡∏ã‡∏≠‡∏á‡πÅ‡∏•‡πâ‡∏ß',
    toast_edited: '‚úì ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡πÅ‡∏•‡πâ‡∏ß',
    toast_imported: '‚úì ‡∏ô‡∏≥‡πÄ‡∏Ç‡πâ‡∏≤‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß',
    toast_invalid: '‚ö† ‡πÑ‡∏ü‡∏•‡πå‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á',
    confirm_delete: '‡∏•‡∏ö‡∏ã‡∏≠‡∏á‡∏ô‡∏µ‡πâ?',
    settings_title: '‡∏ï‡∏±‡πâ‡∏á‡∏Ñ‡πà‡∏≤',
    s_lang: '‡∏†‡∏≤‡∏©‡∏≤',
    s_thresholds: '‡∏Ñ‡πà‡∏≤‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡∏™‡∏µ (‡∏°‡∏ß‡∏ô/‡∏ß‡∏±‡∏ô)',
    s_zone1: '‡∏ó‡∏≠‡∏á  < ‡πÄ‡∏Å‡∏ì‡∏ë‡πå 1',
    s_zone2: '‡∏ü‡πâ‡∏≤‚Üí‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß  ‚â§ ‡πÄ‡∏Å‡∏ì‡∏ë‡πå 2',
    s_zone3: '‡πÄ‡∏Ç‡∏µ‡∏¢‡∏ß‚Üí‡∏™‡πâ‡∏°  ‚â§ ‡πÄ‡∏Å‡∏ì‡∏ë‡πå 3',
    s_zone4: '‡∏™‡πâ‡∏°‚Üí‡πÅ‡∏î‡∏á  ‚â§ ‡πÄ‡∏Å‡∏ì‡∏ë‡πå 4',
    s_zone5: '‡πÅ‡∏î‡∏á‚Üí‡∏°‡πà‡∏ß‡∏á  ‚â§ ‡πÄ‡∏Å‡∏ì‡∏ë‡πå 5',
    s_reset_thresh: '‚Ü∫ ‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô',
    s_apply: '‚úì ‡∏ô‡∏≥‡πÑ‡∏õ‡πÉ‡∏ä‡πâ',
    s_data: '‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•',
    s_delete_range: '‡∏•‡∏ö‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà',
    s_from: '‡∏à‡∏≤‡∏Å',
    s_to: '‡∏ñ‡∏∂‡∏á',
    s_delete_range_btn: 'üóë ‡∏•‡∏ö‡∏ä‡πà‡∏ß‡∏á‡∏ô‡∏µ‡πâ',
    s_danger: '‡πÇ‡∏ã‡∏ô‡∏≠‡∏±‡∏ô‡∏ï‡∏£‡∏≤‡∏¢',
    s_full_reset: '‚ò† ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î',
    s_full_reset_hint: '‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡∏∞‡∏Ñ‡∏∑‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏ï‡πâ‡∏ô',
    s_invalid_range: '‚ö† ‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà‡πÑ‡∏°‡πà‡∏ñ‡∏π‡∏Å‡∏ï‡πâ‡∏≠‡∏á',
    s_packs_in_range: '‡∏ã‡∏≠‡∏á‡∏à‡∏∞‡∏ñ‡∏π‡∏Å‡∏•‡∏ö',
    s_pick_dates: '‡∏Å‡∏£‡∏∏‡∏ì‡∏≤‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏ä‡πà‡∏ß‡∏á‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà',
    toast_thresh_saved: '‚úì ‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å‡∏Ñ‡πà‡∏≤‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡πÅ‡∏•‡πâ‡∏ß',
    toast_thresh_reset: '‚Ü∫ ‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡πà‡∏≤‡πÄ‡∏Å‡∏ì‡∏ë‡πå‡πÅ‡∏•‡πâ‡∏ß',
    toast_range_deleted: '‡∏ã‡∏≠‡∏á‡∏ñ‡∏π‡∏Å‡∏•‡∏ö',
    toast_full_reset: '‚ò† ‡∏•‡πâ‡∏≤‡∏á‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡πÅ‡∏•‡πâ‡∏ß',
    confirm_full_reset: '‡∏•‡∏ö‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î‡πÅ‡∏•‡∏∞‡∏£‡∏µ‡πÄ‡∏ã‡πá‡∏ï‡∏Ñ‡πà‡∏≤‡πÄ‡∏Å‡∏ì‡∏ë‡πå?',
    days: ['‡∏≠‡∏≤','‡∏à','‡∏≠','‡∏û','‡∏û‡∏§','‡∏®','‡∏™'],
    months: ['‡∏°.‡∏Ñ.','‡∏Å.‡∏û.','‡∏°‡∏µ.‡∏Ñ.','‡πÄ‡∏°.‡∏¢.','‡∏û.‡∏Ñ.','‡∏°‡∏¥.‡∏¢.','‡∏Å.‡∏Ñ.','‡∏™.‡∏Ñ.','‡∏Å.‡∏¢.','‡∏ï.‡∏Ñ.','‡∏û.‡∏¢.','‡∏ò.‡∏Ñ.'],
    since_prev: '‡∏ï‡∏±‡πâ‡∏á‡πÅ‡∏ï‡πà‡∏ã‡∏≠‡∏á‡∏Å‡πà‡∏≠‡∏ô',
    sub_less1h: '‡πÑ‡∏°‡πà‡∏ñ‡∏∂‡∏á‡∏´‡∏ô‡∏∂‡πà‡∏á‡∏ä‡∏±‡πà‡∏ß‡πÇ‡∏°‡∏á',
    sub_before: (rem, ref) => `‡∏≠‡∏µ‡∏Å ${rem}‡∏ä‡∏° ‡∏ñ‡∏∂‡∏á‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢`,
    sub_near: (ref) => `‡πÉ‡∏Å‡∏•‡πâ‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ (${ref}‡∏ä‡∏°)`,
    sub_bravo: '‚úì ‡πÄ‡∏Å‡∏¥‡∏ô‡∏Ñ‡πà‡∏≤‡πÄ‡∏â‡∏•‡∏µ‡πà‡∏¢ ‚Äî ‡∏¢‡∏≠‡∏î‡πÄ‡∏¢‡∏µ‡πà‡∏¢‡∏°!',
  },
  km: {
    avg_label: '·ûÄ·üí·ûè·û∂·ûî·üã/·ûê·üí·ûÑ·üÉ (·ûò·ûí·üí·ûô·ûò ·ü£ ·ûê·üí·ûÑ·üÉ)',
    trend_lbl: '·ûì·û∑·ûì·üí·ûì·û∂·ûÄ·û∂·ûö (7·ûê)',
    pack7_lbl: '·ûÄ·ûâ·üí·ûÖ·ûî·üã / 7·ûê',
    pack30_lbl: '·ûÄ·ûâ·üí·ûÖ·ûî·üã / 30·ûê',
    hero_lbl: '·ûò·üâ·üÑ·ûÑ·ûÖ·û∂·ûî·üã·ûè·û∂·üÜ·ûÑ·ûñ·û∏·ûÄ·ûâ·üí·ûÖ·ûî·üã·ûÖ·ûª·ûÑ·ûÄ·üí·ûö·üÑ·ûô',
    avg7h_lbl: '·ûò·ûí·üí·ûô·ûò 7·ûê',
    new_pack: '·ûÄ·ûâ·üí·ûÖ·ûî·üã·ûê·üí·ûò·û∏',
    history_title: '·ûî·üí·ûö·ûú·ûè·üí·ûè·û∑·ûê·üí·ûò·û∏·üó',
    date_time_lbl: '·ûÄ·û∂·ûõ·ûî·ûö·û∑·ûÖ·üí·ûÜ·üÅ·ûë ·ûì·û∑·ûÑ·ûò·üâ·üÑ·ûÑ',
    cancel_btn: '·ûî·üÑ·üá·ûî·ûÑ·üã',
    save_btn: '·ûö·ûÄ·üí·ûü·û∂·ûë·ûª·ûÄ',
    stats_title: '·ûü·üí·ûê·û∑·ûè·û∑',
    cig3j: '·ûÄ·üí·ûè·û∂·ûî·üã/·ûê (3·ûê)',
    cig30j: '·ûÄ·üí·ûè·û∂·ûî·üã/·ûê (30·ûê)',
    h3j: '·ûò·üâ·üÑ·ûÑ/·ûÄ·ûâ·üí·ûÖ·ûî·üã (3·ûê)',
    h30j: '·ûò·üâ·üÑ·ûÑ/·ûÄ·ûâ·üí·ûÖ·ûî·üã (30·ûê)',
    chart1_title: '·ûÄ·üí·ûè·û∂·ûî·üã/·ûê·üí·ûÑ·üÉ ‚Äî ·ûò·ûí·üí·ûô·ûò ·ü£ ·ûê·üí·ûÑ·üÉ',
    chart2_title: '·ûÖ·ûì·üí·ûõ·üÑ·üá·ûñ·üÅ·ûõ·ûö·ûú·û∂·ûÑ·ûÄ·ûâ·üí·ûÖ·ûî·üã (·ûò·üâ·üÑ·ûÑ)',
    swipe_hint: '‚Üê ·û¢·ûº·ûü·ûä·ûæ·ûò·üí·ûî·û∏·ûö·ûª·ûÄ·ûö·ûÄ ‚Üí',
    data_title: '·ûë·û∑·ûì·üí·ûì·ûì·üê·ûô',
    export_btn: '‚¨á ·ûì·û∂·üÜ·ûÖ·üÅ·ûâ (JSON)',
    import_btn: '‚¨Ü ·ûì·û∂·üÜ·ûÖ·ûº·ûõ (JSON)',
    stats_btn: 'STATS ‚ñ∏',
    modal_edit: '·ûÄ·üÇ·ûî·üí·ûö·üÇ·ûÄ·ûâ·üí·ûÖ·ûî·üã',
    modal_add: '·ûÄ·ûâ·üí·ûÖ·ûî·üã·ûê·üí·ûò·û∏',
    toast_added: 'üì¶ ·ûî·û∂·ûì·ûî·ûì·üí·ûê·üÇ·ûò·ûÄ·ûâ·üí·ûÖ·ûî·üã',
    toast_deleted: 'üóë ·ûî·û∂·ûì·ûõ·ûª·ûî·ûÄ·ûâ·üí·ûÖ·ûî·üã',
    toast_edited: '‚úì ·ûî·û∂·ûì·ûö·ûÄ·üí·ûü·û∂·ûë·ûª·ûÄ',
    toast_imported: '‚úì ·ûî·û∂·ûì·ûì·û∂·üÜ·ûÖ·ûº·ûõ·ûë·û∑·ûì·üí·ûì·ûì·üê·ûô',
    toast_invalid: '‚ö† ·ûØ·ûÄ·ûü·û∂·ûö·ûò·û∑·ûì·ûè·üí·ûö·ûπ·ûò·ûè·üí·ûö·ûº·ûú',
    confirm_delete: '·ûõ·ûª·ûî·ûÄ·ûâ·üí·ûÖ·ûî·üã·ûì·üÅ·üá?',
    settings_title: '·ûÄ·û∂·ûö·ûÄ·üÜ·ûé·ûè·üã',
    s_lang: '·ûó·û∂·ûü·û∂',
    s_thresholds: '·ûÄ·üÜ·û†·û∑·ûè·ûñ·ûé·üå (·ûÄ·üí·ûè·û∂·ûî·üã/·ûê·üí·ûÑ·üÉ)',
    s_zone1: '·ûò·û∂·ûü  < ·ûÄ·üÜ·û†·û∑·ûè 1',
    s_zone2: '·ûÅ·üÄ·ûú‚Üí·ûî·üÉ·ûè·ûÑ  ‚â§ ·ûÄ·üÜ·û†·û∑·ûè 2',
    s_zone3: '·ûî·üÉ·ûè·ûÑ‚Üí·ûë·ûπ·ûÄ·ûÄ·üí·ûö·ûº·ûÖ  ‚â§ ·ûÄ·üÜ·û†·û∑·ûè 3',
    s_zone4: '·ûë·ûπ·ûÄ·ûÄ·üí·ûö·ûº·ûÖ‚Üí·ûÄ·üí·ûö·û†·ûò  ‚â§ ·ûÄ·üÜ·û†·û∑·ûè 4',
    s_zone5: '·ûÄ·üí·ûö·û†·ûò‚Üí·ûü·üí·ûú·û∂·ûô  ‚â§ ·ûÄ·üÜ·û†·û∑·ûè 5',
    s_reset_thresh: '‚Ü∫ ·ûõ·üÜ·ûì·û∂·üÜ·ûä·ûæ·ûò',
    s_apply: '‚úì ·û¢·ûì·ûª·ûú·ûè·üí·ûè',
    s_data: '·ûë·û∑·ûì·üí·ûì·ûì·üê·ûô',
    s_delete_range: '·ûõ·ûª·ûî·ûá·ûΩ·ûö·ûÄ·û∂·ûõ·ûî·ûö·û∑·ûÖ·üí·ûÜ·üÅ·ûë',
    s_from: '·ûñ·û∏',
    s_to: '·ûä·ûõ·üã',
    s_delete_range_btn: 'üóë ·ûõ·ûª·ûî·ûá·ûΩ·ûö·ûì·üÅ·üá',
    s_danger: '·ûè·üÜ·ûî·ûì·üã·ûÇ·üí·ûö·üÑ·üá·ûê·üí·ûì·û∂·ûÄ·üã',
    s_full_reset: '‚ò† ·ûÄ·üÜ·ûé·ûè·üã·û°·ûæ·ûÑ·ûú·û∑·ûâ·ûë·û∂·üÜ·ûÑ·ûü·üí·ûö·ûª·ûÑ',
    s_full_reset_hint: '·ûõ·ûª·ûî·ûë·û∑·ûì·üí·ûì·ûì·üê·ûô·ûë·û∂·üÜ·ûÑ·û¢·ûü·üã ·ûì·û∑·ûÑ·ûü·üí·ûä·û∂·ûö·ûÄ·üÜ·û†·û∑·ûè·ûä·ûæ·ûò',
    s_invalid_range: '‚ö† ·ûÄ·û∂·ûõ·ûî·ûö·û∑·ûÖ·üí·ûÜ·üÅ·ûë·ûò·û∑·ûì·ûè·üí·ûö·ûπ·ûò·ûè·üí·ûö·ûº·ûú',
    s_packs_in_range: '·ûÄ·ûâ·üí·ûÖ·ûî·üã·ûì·ûπ·ûÑ·ûè·üí·ûö·ûº·ûú·ûî·û∂·ûì·ûõ·ûª·ûî',
    s_pick_dates: '·ûü·ûº·ûò·ûá·üí·ûö·ûæ·ûü·ûö·ûæ·ûü·ûá·ûΩ·ûö·ûÄ·û∂·ûõ·ûî·ûö·û∑·ûÖ·üí·ûÜ·üÅ·ûë',
    toast_thresh_saved: '‚úì ·ûî·û∂·ûì·ûö·ûÄ·üí·ûü·û∂·ûë·ûª·ûÄ·ûÄ·üÜ·û†·û∑·ûè',
    toast_thresh_reset: '‚Ü∫ ·ûî·û∂·ûì·ûÄ·üÜ·ûé·ûè·üã·ûÄ·üÜ·û†·û∑·ûè·û°·ûæ·ûÑ·ûú·û∑·ûâ',
    toast_range_deleted: '·ûÄ·ûâ·üí·ûÖ·ûî·üã·ûè·üí·ûö·ûº·ûú·ûî·û∂·ûì·ûõ·ûª·ûî',
    toast_full_reset: '‚ò† ·ûë·û∑·ûì·üí·ûì·ûì·üê·ûô·ûè·üí·ûö·ûº·ûú·ûî·û∂·ûì·ûõ·ûª·ûî',
    confirm_full_reset: '·ûõ·ûª·ûî·ûë·û∑·ûì·üí·ûì·ûì·üê·ûô·ûë·û∂·üÜ·ûÑ·û¢·ûü·üã ·ûì·û∑·ûÑ·ûÄ·üÜ·ûé·ûè·üã·û°·ûæ·ûÑ·ûú·û∑·ûâ?',
    days: ['·û¢·û∂','·ûÖ','·û¢','·ûñ','·ûñ·üí·ûö','·ûü·ûª','·ûü'],
    months: ['·ûò·ûÄ·ûö·û∂','·ûÄ·ûª·ûò·üí·ûó·üà','·ûò·û∏·ûì·û∂','·ûò·üÅ·ûü·û∂','·ûß·ûü·ûó·û∂','·ûò·û∑·ûê·ûª·ûì·û∂','·ûÄ·ûÄ·üí·ûÄ·ûä·û∂','·ûü·û∏·û†·û∂','·ûÄ·ûâ·üí·ûâ·û∂','·ûè·ûª·ûõ·û∂','·ûú·û∑·ûÖ·üí·ûÜ·û∑·ûÄ·û∂','·ûí·üí·ûì·ûº'],
    since_prev: '·ûÖ·û∂·ûî·üã·ûñ·û∏·ûò·ûª·ûì',
    sub_less1h: '·ûè·û∑·ûÖ·ûá·û∂·ûÑ·ûò·ûΩ·ûô·ûò·üâ·üÑ·ûÑ',
    sub_before: (rem, ref) => `·ûì·üÖ·ûò·û∂·ûì ${rem} ·ûò·üâ·üÑ·ûÑ ·ûò·ûª·ûì·ûò·ûí·üí·ûô·ûò`,
    sub_near: (ref) => `·ûá·û∑·ûè·ûä·ûõ·üã·ûò·ûí·üí·ûô·ûò (${ref}·ûò·üâ·üÑ·ûÑ)`,
    sub_bravo: '‚úì ·ûõ·ûæ·ûü·ûò·ûí·üí·ûô·ûò ‚Äî ·ûõ·üí·û¢·ûé·û∂·ûü·üã!',
  },
  de: {
    avg_label: 'ZIG / TAG (3-TAGE-DURCHSCHN.)',
    trend_lbl: 'Trend (7T)',
    pack30_lbl: 'Pack. / 30T',
    pack7_lbl: 'Pack. / 7T',
    avg7h_lbl: '√ò 7T',
    hero_lbl: 'STUNDEN SEIT LETZTER PACKUNG',
    new_pack: 'NEUE PACKUNG',
    history_title: 'LETZTE EINTR√ÑGE',
    date_time_lbl: 'DATUM & UHRZEIT',
    cancel_btn: 'ABBRECHEN',
    save_btn: 'SPEICHERN',
    stats_title: 'STATISTIKEN',
    cig3j: 'Zig/T (3T)',
    cig30j: 'Zig/T (30T)',
    h3j: 'Std/Pack (3T)',
    h30j: 'Std/Pack (30T)',
    chart1_title: 'ZIG/TAG ‚Äî 3T-ROLLEND',
    chart2_title: 'ABSTAND ZWISCHEN PACKUNGEN (Std)',
    swipe_hint: '‚Üê wischen zum Navigieren ‚Üí',
    data_title: 'DATEN',
    export_btn: '‚¨á Exportieren (JSON)',
    import_btn: '‚¨Ü Importieren (JSON)',
    stats_btn: 'STATS ‚ñ∏',
    modal_edit: 'EINTRAG BEARBEITEN',
    modal_add: 'NEUE PACKUNG',
    toast_added: 'üì¶ Packung hinzugef√ºgt',
    toast_deleted: 'üóë Packung gel√∂scht',
    toast_edited: '‚úì Gespeichert',
    toast_imported: '‚úì Daten importiert',
    toast_invalid: '‚ö† Ung√ºltige Datei',
    settings_title: 'EINSTELLUNGEN',
    s_lang: 'SPRACHE',
    s_thresholds: 'FARBSCHWELLEN (Zig/Tag)',
    s_zone1: 'Gold  < Schwelle 1',
    s_zone2: 'Blau‚ÜíGr√ºn  ‚â§ Schwelle 2',
    s_zone3: 'Gr√ºn‚ÜíOrange  ‚â§ Schwelle 3',
    s_zone4: 'Orange‚ÜíRot  ‚â§ Schwelle 4',
    s_zone5: 'Rot‚ÜíLila  ‚â§ Schwelle 5',
    s_reset_thresh: '‚Ü∫ Standard',
    s_apply: '‚úì Anwenden',
    s_data: 'DATEN',
    s_delete_range: 'DATUMSBEREICH L√ñSCHEN',
    s_from: 'Von',
    s_to: 'Bis',
    s_delete_range_btn: 'üóë Diesen Bereich l√∂schen',
    s_danger: 'GEFAHRENZONE',
    s_full_reset: '‚ò† VOLLST√ÑNDIGER RESET',
    s_full_reset_hint: 'L√∂scht alle Daten und stellt Standardschwellen wieder her',
    s_invalid_range: '‚ö† Ung√ºltige Daten',
    s_packs_in_range: 'Packung(en) werden gel√∂scht',
    s_pick_dates: 'Bitte Datumsbereich w√§hlen',
    toast_thresh_saved: '‚úì Schwellen gespeichert',
    toast_thresh_reset: '‚Ü∫ Schwellen zur√ºckgesetzt',
    toast_range_deleted: 'Packung(en) gel√∂scht',
    toast_full_reset: '‚ò† Daten gel√∂scht',
    confirm_full_reset: 'ALLE Daten l√∂schen und Schwellen zur√ºcksetzen?',
    confirm_delete: 'Diesen Eintrag l√∂schen?',
    days: ['So','Mo','Di','Mi','Do','Fr','Sa'],
    months: ['Jan','Feb','M√§r','Apr','Mai','Jun','Jul','Aug','Sep','Okt','Nov','Dez'],
    since_prev: 'seit vorheriger',
    sub_less1h: 'weniger als eine Stunde',
    sub_before: (rem, ref) => `noch ${rem}h bis zum Durchschnitt`,
    sub_near: (ref) => `fast beim Durchschnitt (${ref}h)`,
    sub_bravo: '‚úì Durchschnitt √ºbertroffen ‚Äî Bravo!',
  }
};

let currentLang = 'fr';

function detectLang() {
  const saved = localStorage.getItem('cigtracker_lang');
  if (saved && TRANSLATIONS[saved]) return saved;
  const nav = (navigator.language || navigator.userLanguage || 'fr').slice(0,2).toLowerCase();
  // Map some navigator codes
  const codeMap = { 'zh': 'zh', 'hi': 'hi', 'vi': 'vi', 'th': 'th', 'km': 'km', 'ru': 'ru', 'it': 'it', 'pt': 'pt' };
  const mapped = codeMap[nav] || nav;
  return TRANSLATIONS[mapped] ? mapped : 'fr';
}

function setLang(lang) {
  if (!TRANSLATIONS[lang]) return;
  currentLang = lang;
  localStorage.setItem('cigtracker_lang', lang);
  // Update flag buttons
  document.querySelectorAll('.lang-btn').forEach(b => b.classList.remove('active'));
  const btn = document.getElementById('lbtn-' + lang);
  if (btn) btn.classList.add('active');
  // Apply all static translations
  document.querySelectorAll('[data-i18n]').forEach(el => {
    const key = el.getAttribute('data-i18n');
    if (TRANSLATIONS[lang][key]) el.textContent = TRANSLATIONS[lang][key];
  });
  // Stats button (separate ID)
  document.getElementById('statsBtn2').textContent = TRANSLATIONS[lang].stats_btn;
  // Lang tiles in settings
  updateLangTiles();
  // Re-render list (dates localised) and update dynamic texts
  update();
}

function t(key, ...args) {
  const val = TRANSLATIONS[currentLang][key];
  if (typeof val === 'function') return val(...args);
  return val || key;
}

// ===================== DATA =====================
const STORE_KEY = 'cigtracker_v3';
const THRESH_KEY = 'cigtracker_thresh';
const DEFAULT_THRESHOLDS = { t1: 10, t2: 15, t3: 20, t4: 30, t5: 40 };
let thresholds = { ...DEFAULT_THRESHOLDS };
let packs = []; // [{id, ts}] ts = timestamp ms
let editingId = null;

function load() {
  try {
    const d = localStorage.getItem(STORE_KEY);
    if (d) packs = JSON.parse(d);
  } catch(e) {}
  try {
    const th = localStorage.getItem(THRESH_KEY);
    if (th) thresholds = { ...DEFAULT_THRESHOLDS, ...JSON.parse(th) };
  } catch(e) {}
  // Demo seed: 11 entries Feb 9-20 2026
  // prev week (Feb 9-14): 6 packs, this week (Feb 16-20): 5 packs ‚Üí trend ‚âà -17%
  if (packs.length === 0) {
    packs = [{"id":1770624000000,"ts":1770624000000},{"id":1770715800001,"ts":1770715800000},{"id":1770796800002,"ts":1770796800000},{"id":1770890400003,"ts":1770890400000},{"id":1770973200004,"ts":1770973200000},{"id":1771066800005,"ts":1771066800000},{"id":1771228800006,"ts":1771228800000},{"id":1771322400007,"ts":1771322400000},{"id":1771405200008,"ts":1771405200000},{"id":1771498800009,"ts":1771498800000},{"id":1771579800010,"ts":1771579800000}];
    save();
  }
}

function save() {
  localStorage.setItem(STORE_KEY, JSON.stringify(packs));
}

// ===================== CALCULATIONS =====================
// Helper: cig/day from avg hours between packs
// = 20 cig per pack / avg hours between packs * 24h
// This is immune to "last pack not yet finished" bias
function cigPerDayFromInterval(avgH) {
  if (avgH <= 0) return 0;
  return 20 / avgH * 24;
}

// Helper: avg cig/day over a window using real elapsed time (used for TREND only)
function avgCigPerDay(packsInWindow, windowHours, windowEnd) {
  if (packsInWindow.length === 0) return 0;
  const firstTs = packsInWindow[0].ts;
  const windowStart = windowEnd - windowHours * 3600000;
  const elapsedH = (windowEnd - Math.max(firstTs, windowStart)) / 3600000;
  const divisorDays = Math.max(elapsedH, 1) / 24;
  return (packsInWindow.length * 20) / divisorDays;
}

// Helper: avg hours between consecutive packs in a list
function avgHoursBetween(packList, fallbackList) {
  if (packList.length > 1) {
    let total = 0;
    for (let i = 1; i < packList.length; i++)
      total += (packList[i].ts - packList[i-1].ts) / 3600000;
    return total / (packList.length - 1);
  }
  // Only 1 pack in window: use gap to the previous pack outside window
  if (packList.length === 1 && fallbackList) {
    const idx = fallbackList.findIndex(p => p.ts === packList[0].ts);
    if (idx > 0) return (packList[0].ts - fallbackList[idx-1].ts) / 3600000;
  }
  return 0;
}

function calcStats() {
  if (packs.length === 0) return { avg3: 0, avg30: 0, avgH3: 0, avgH30: 0, avgH7: 0, ppm7: 0, hoursSinceLast: 0, total: 0, trendPct: 0, trendDir: 0, trendValid: false, refH: 24 };
  const sorted = [...packs].sort((a,b) => a.ts - b.ts);
  const now = Date.now();

  // Window cutoffs (pure timestamps, no calendar rounding)
  const cut3  = now - 3  * 24 * 3600000;
  const cut7  = now - 7  * 24 * 3600000;
  const cut14 = now - 14 * 24 * 3600000;
  const cut30 = now - 30 * 24 * 3600000;

  const packs3  = sorted.filter(p => p.ts > cut3);
  const packs7d = sorted.filter(p => p.ts > cut7);
  const packs30 = sorted.filter(p => p.ts > cut30);

  // Cig/day averages ‚Äî derived from avg interval between packs (unbiased by last open pack)
  // Computed after avgH calculations below, placeholder here
  let avg3 = 0, avg30 = 0;

  // Avg hours between packs
  const avgH3  = avgHoursBetween(packs3,  sorted);
  const avgH30 = avgHoursBetween(packs30, sorted);
  const avgH7  = avgHoursBetween(packs7d, sorted);

  // Cig/day from interval (stable ‚Äî not affected by last open pack)
  // Fallback chain: use narrowest window with enough data, widen if needed
  avg3  = avgH3  > 0 ? cigPerDayFromInterval(avgH3)
        : avgH7  > 0 ? cigPerDayFromInterval(avgH7)
        : avgH30 > 0 ? cigPerDayFromInterval(avgH30) : 0;
  avg30 = avgH30 > 0 ? cigPerDayFromInterval(avgH30)
        : avgH7  > 0 ? cigPerDayFromInterval(avgH7)
        : avgH3  > 0 ? cigPerDayFromInterval(avgH3)  : 0;

  // Hours since last pack
  const lastTs = sorted[sorted.length - 1].ts;
  const hoursSinceLast = (now - lastTs) / 3600000;

  // Trend: compare cig/day rate this 7d vs prev 7d (both using real elapsed time)
  const prevWeek = sorted.filter(p => p.ts > cut14 && p.ts <= cut7);
  const avgRateThis = avgCigPerDay(packs7d, 168, now);
  const avgRatePrev = avgCigPerDay(prevWeek, 168, cut7); // prev window ends at cut7
  let trendPct = 0, trendDir = 0, trendValid = false;
  if (prevWeek.length > 0 && avgRatePrev > 0) {
    trendPct = Math.round((avgRateThis - avgRatePrev) / avgRatePrev * 100);
    trendDir = trendPct > 2 ? 1 : trendPct < -2 ? -1 : 0;
    trendValid = true;
  }

  // ppm7 = exact pack count in last 7 days (168h rolling, pure timestamp)
  const ppm7 = packs7d.length;

  // refH for progress bar
  const refH = avgH7 > 0 ? avgH7 : avgH3 > 0 ? avgH3 : 24;

  return { avg3, avg30, avgH3, avgH30, avgH7, ppm7, hoursSinceLast, total: sorted.length, trendPct, trendDir, trendValid, refH };
}

// Lerp between two hex colors by t (0..1)
function lerpColor(a, b, lr) {
  const ah = parseInt(a.slice(1),16), bh = parseInt(b.slice(1),16);
  const ar = ah>>16, ag = (ah>>8)&0xff, ab = ah&0xff;
  const br = bh>>16, bg = (bh>>8)&0xff, bb = bh&0xff;
  const rr = Math.round(ar + (br-ar)*lr);
  const rg = Math.round(ag + (bg-ag)*lr);
  const rb = Math.round(ab + (bb-ab)*lr);
  return '#'+[rr,rg,rb].map(v=>v.toString(16).padStart(2,'0')).join('');
}

function applyTheme(avg3) {
  const { t1, t2, t3, t4, t5 } = thresholds;
  let accent, bg1, bg2;
  if (avg3 < t1) {
    const shimmer = 0.5 + 0.5 * Math.sin(Date.now() / 1200);
    accent = lerpColor('#ffd700', '#ffb300', shimmer * 0.3);
    bg1 = '#1a1200'; bg2 = '#2a1e00';
  } else if (avg3 <= t2) {
    const lr = (avg3 - t1) / Math.max(1, t2 - t1);
    accent = lerpColor('#56cfe1', '#52b788', lr);
    bg1 = lerpColor('#001a2e', '#001a12', lr);
    bg2 = lerpColor('#00122e', '#001a12', lr);
  } else if (avg3 <= t3) {
    const lr = (avg3 - t2) / Math.max(1, t3 - t2);
    accent = lerpColor('#52b788', '#ff9800', lr);
    bg1 = lerpColor('#001a12', '#1a0800', lr);
    bg2 = lerpColor('#001a12', '#2a1000', lr);
  } else if (avg3 <= t4) {
    const lr = (avg3 - t3) / Math.max(1, t4 - t3);
    accent = lerpColor('#ff9800', '#ff2222', lr);
    bg1 = lerpColor('#1a0800', '#1a0000', lr);
    bg2 = lerpColor('#2a1000', '#2a0000', lr);
  } else if (avg3 <= t5) {
    const lr = (avg3 - t4) / Math.max(1, t5 - t4);
    accent = lerpColor('#ff2222', '#7b00d4', lr);
    bg1 = lerpColor('#1a0000', '#0d001a', lr);
    bg2 = lerpColor('#2a0000', '#1a0030', lr);
  } else {
    accent = '#7b00d4';
    bg1 = '#0d001a'; bg2 = '#1a0030';
  }

  document.documentElement.style.setProperty('--accent', accent);
  document.querySelector('.bg-layer').style.background =
    `linear-gradient(135deg, ${bg1} 0%, ${bg2} 60%, ${bg1} 100%)`;
}

// ===================== UI UPDATE =====================
function update() {
  const stats = calcStats();
  const { avg3, avg30, avgH3, avgH30, avgH7, ppm7, hoursSinceLast, total, trendPct, trendDir, trendValid, refH } = stats;

  document.getElementById('avgNumber').textContent = avg3 > 0 ? avg3.toFixed(1) : '‚Äì';
  document.getElementById('statPPM').textContent = ppm7 > 0 ? ppm7 : '‚Äì';

  // Tendance: ‚Üì = vert (bonne r√©duction), = = orange, ‚Üë = rouge (augmentation)
  const trendEl = document.getElementById('statTrend');
  if (!trendValid) {
    trendEl.textContent = '‚Äì';
    trendEl.className = 'val trend-stable';
  } else if (trendDir === -1) {
    trendEl.textContent = '‚Üì ' + trendPct + '%';
    trendEl.className = 'val trend-good';
  } else if (trendDir === 1) {
    trendEl.textContent = '‚Üë +' + trendPct + '%';
    trendEl.className = 'val trend-bad';
  } else {
    trendEl.textContent = '= ' + (trendPct >= 0 ? '+' : '') + trendPct + '%';
    trendEl.className = 'val trend-stable';
  }

  // Hero ‚Äî heures depuis dernier paquet + avg 7j
  const avgH7El = document.getElementById('heroAvgH7');
  if (avgH7El) avgH7El.textContent = avgH7 > 0 ? avgH7.toFixed(1) : '‚Äì';
  const hEl = document.getElementById('statLast');
  hEl.textContent = total > 0 ? hoursSinceLast.toFixed(1) : '‚Äì';

  // Progress bar: 0% = just opened, 100% = at average interval (or 24h max)
  const barRef = Math.max(refH, 4); // ref = avgH7 if available
  const barPct = total > 0 ? Math.min(100, (hoursSinceLast / barRef) * 100) : 0;
  document.getElementById('heroBar').style.width = barPct + '%';

  // Sublabel: time-based encouragement
  const subEl = document.getElementById('heroSublabel');
  if (total > 0) {
    if (hoursSinceLast < 1) subEl.textContent = t('sub_less1h');
    else if (barPct < 50) subEl.textContent = t('sub_before', (barRef - hoursSinceLast).toFixed(1), barRef.toFixed(1));
    else if (barPct < 100) subEl.textContent = t('sub_near', barRef.toFixed(1));
    else subEl.textContent = t('sub_bravo');
  } else { subEl.textContent = ''; }

  // Theme
  applyTheme(avg3);

  renderList();
}

function renderList() {
  const sorted = [...packs].sort((a,b) => b.ts - a.ts); // newest first
  const list = document.getElementById('packList');
  list.innerHTML = '';
  const show = sorted.slice(0, 20);
  show.forEach((p, i) => {
    const d = new Date(p.ts);
    const prev = sorted[i+1];
    const deltaH = prev ? ((p.ts - prev.ts) / 3600000).toFixed(1) : '‚Äì';
    const item = document.createElement('div');
    item.className = 'pack-item';
    item.innerHTML = `
      <div class="pack-num">${sorted.length - i}</div>
      <div class="pack-info">
        <div class="pack-datetime">${formatDate(d)}</div>
        <div class="pack-delta">+${deltaH}h ${t('since_prev')}</div>
      </div>
      <div class="pack-actions">
        <button class="pack-action-btn" onclick="event.stopPropagation();editPack(${p.id})" title="Modifier">‚úé</button>
        <button class="pack-action-btn del" onclick="event.stopPropagation();deletePack(${p.id})" title="Supprimer">‚úï</button>
      </div>
    `;
    list.appendChild(item);
  });
}

function formatDate(d) {
  const days = TRANSLATIONS[currentLang].days;
  const months = TRANSLATIONS[currentLang].months;
  return `${days[d.getDay()]} ${d.getDate()} ${months[d.getMonth()]} ‚Äî ${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}`;
}

// ===================== ACTIONS =====================
function addPack() {
  const btn = document.getElementById('skullBtn');
  btn.classList.remove('pulsing');
  void btn.offsetWidth;
  btn.classList.add('pulsing');

  const newId = Date.now();
  packs.push({ id: newId, ts: Date.now() });
  save();
  update();
  showToast(t('toast_added'));

  if (navigator.vibrate) navigator.vibrate([50, 30, 80]);
}

function editPack(id) {
  editingId = id;
  const p = packs.find(x => x.id === id);
  if (!p) return;
  const d = new Date(p.ts);
  const local = new Date(d.getTime() - d.getTimezoneOffset() * 60000).toISOString().slice(0,16);
  document.getElementById('editDatetime').value = local;
  document.getElementById('modalTitle').textContent = t('modal_edit');
  document.getElementById('editModal').classList.add('open');
}

function deletePack(id) {
  if (!confirm(t('confirm_delete'))) return;
  packs = packs.filter(p => p.id !== id);
  save();
  update();
  showToast(t('toast_deleted'));
}

function closeModal() {
  document.getElementById('editModal').classList.remove('open');
  editingId = null;
}

function saveEdit() {
  const val = document.getElementById('editDatetime').value;
  if (!val) return;
  const ts = new Date(val).getTime();
  const p = packs.find(x => x.id === editingId);
  if (p) { p.ts = ts; save(); update(); }
  closeModal();
  showToast(t('toast_edited'));
}

// Close modal on overlay click
document.getElementById('editModal').addEventListener('click', function(e) {
  if (e.target === this) closeModal();
});

// ===================== STATS PANEL =====================
let chartDaily = null, chartInterval = null;

function openStats() {
  document.getElementById('statsPanel').classList.add('open');
  const stats = calcStats();
  document.getElementById('sAvg3').textContent = stats.avg3.toFixed(1);
  document.getElementById('sAvg30').textContent = stats.avg30.toFixed(1);
  document.getElementById('sAvgH3').textContent = stats.avgH3.toFixed(1);
  document.getElementById('sAvgH30').textContent = stats.avgH30.toFixed(1);
  drawCharts();
}

function closeStats() {
  document.getElementById('statsPanel').classList.remove('open');
}

// ===================== CHARTS =====================
// Swipeable bar chart engine
// Each chart has its own state: offset = index of leftmost visible day (0 = oldest)
const WIN = 30; // days visible at once

const chartState = {
  daily:    { offset: 0, labels: [], values: [], dragging: false, startX: 0, startOffset: 0 },
  interval: { offset: 0, labels: [], values: [], dragging: false, startX: 0, startOffset: 0 }
};

function buildRollingAvgHistory() {
  // Equivalent to ODS MOYENNE() over 3 days:
  // Each bar = (packs in 72h window √ó 20) / divisor
  // divisor = min(3, days elapsed since very first pack) ‚Üí full 3d once history >= 3d
  const sorted = [...packs].sort((a,b) => a.ts - b.ts);
  if (sorted.length === 0) return { labels: [], values: [] };
  const msDay = 86400000;
  const ms72h = 72 * 3600000;
  const globalFirstTs = sorted[0].ts; // very first pack ever
  const firstDay = new Date(globalFirstTs); firstDay.setHours(0,0,0,0);
  const today = new Date(); today.setHours(23,59,59,999);
  const labels = [], values = [];
  for (let d = new Date(firstDay); d <= today; d = new Date(d.getTime() + msDay)) {
    const windowEnd = new Date(d); windowEnd.setHours(23,59,59,999);
    const windowEndTs = windowEnd.getTime();
    const windowStartTs = windowEndTs - ms72h;
    const packsInWindow = sorted.filter(p => p.ts > windowStartTs && p.ts <= windowEndTs);
    let val = 0;
    if (packsInWindow.length > 0) {
      // Divisor: 3 full days, EXCEPT ramp-up for first 3 days of all-time history
      const elapsedSinceFirstPackH = (windowEndTs - globalFirstTs) / 3600000;
      const divisorH = Math.min(72, Math.max(elapsedSinceFirstPackH, 1));
      val = packsInWindow.length * 20 / (divisorH / 24);
    }
    values.push(+val.toFixed(1));
    labels.push(`${d.getDate()}/${d.getMonth()+1}`);
  }
  return { labels, values };
}

function buildIntervalHistory() {
  const sorted = [...packs].sort((a,b) => a.ts - b.ts);
  const labels = [], values = [];
  for (let i = 1; i < sorted.length; i++) {
    values.push(+((sorted[i].ts - sorted[i-1].ts) / 3600000).toFixed(1));
    const d = new Date(sorted[i].ts);
    labels.push(`${d.getDate()}/${d.getMonth()+1}`);
  }
  return { labels, values };
}

function getAccent() {
  return document.documentElement.style.getPropertyValue('--accent').trim() || '#ffd700';
}

function drawChart(canvasId, state, rangeElId) {
  const canvas = document.getElementById(canvasId);
  if (!canvas) return;
  const dpr = window.devicePixelRatio || 1;
  const cssW = canvas.clientWidth || canvas.parentElement.clientWidth || 340;
  const cssH = 160;
  canvas.width = cssW * dpr;
  canvas.height = cssH * dpr;
  canvas.style.width = cssW + 'px';
  canvas.style.height = cssH + 'px';
  const ctx = canvas.getContext('2d');
  ctx.scale(dpr, dpr);
  const W = cssW, H = cssH;

  const color = getAccent();
  const { labels, values, offset } = state;
  const total = labels.length;
  const win = Math.min(WIN, total);
  const safeOffset = Math.max(0, Math.min(offset, total - win));
  const visLabels = labels.slice(safeOffset, safeOffset + win);
  const visValues = values.slice(safeOffset, safeOffset + win);

  // Update range label
  if (rangeElId && visLabels.length > 0) {
    const el = document.getElementById(rangeElId);
    if (el) el.textContent = `${visLabels[0]} ‚Äî ${visLabels[visLabels.length-1]}`;
  }

  const pad = { top: 12, right: 8, bottom: 28, left: 30 };
  const iW = W - pad.left - pad.right;
  const iH = H - pad.top - pad.bottom;

  ctx.clearRect(0, 0, W, H);

  if (visValues.length === 0) {
    ctx.fillStyle = 'rgba(255,255,255,0.3)';
    ctx.font = '11px Courier Prime, monospace';
    ctx.textAlign = 'center';
    ctx.fillText('Pas assez de donn√©es', W/2, H/2);
    return;
  }

  const max = Math.max(...visValues, 1);
  const n = visValues.length;
  const barW = iW / n * 0.72;
  const step = iW / n;

  // Grid
  ctx.strokeStyle = 'rgba(255,255,255,0.07)';
  ctx.lineWidth = 1;
  for (let i = 0; i <= 4; i++) {
    const y = pad.top + iH - (i/4) * iH;
    ctx.beginPath(); ctx.moveTo(pad.left, y); ctx.lineTo(pad.left + iW, y); ctx.stroke();
    ctx.fillStyle = 'rgba(255,255,255,0.28)';
    ctx.font = `${Math.min(9, Math.floor(pad.left * 0.85))}px Courier Prime, monospace`;
    ctx.textAlign = 'right';
    ctx.fillText(Math.round(i/4 * max), pad.left - 3, y + 3);
  }

  // Bars
  visValues.forEach((val, i) => {
    const x = pad.left + i * step + (step - barW) / 2;
    const bH = Math.max(val === 0 ? 0 : 2, (val / max) * iH);
    const y = pad.top + iH - bH;
    const grad = ctx.createLinearGradient(0, y, 0, pad.top + iH);
    grad.addColorStop(0, color);
    grad.addColorStop(1, color + '33');
    ctx.fillStyle = grad;
    if (ctx.roundRect) ctx.roundRect(x, y, barW, bH, [2, 2, 0, 0]);
    else ctx.rect(x, y, barW, bH);
    ctx.fill();
  });

  // X labels ‚Äî every 5th or every if few bars
  ctx.fillStyle = 'rgba(255,255,255,0.38)';
  const fontSize = n <= 10 ? 9 : 8;
  ctx.font = `${fontSize}px Courier Prime, monospace`;
  ctx.textAlign = 'center';
  const labelStep = n <= 10 ? 1 : n <= 20 ? 2 : 5;
  visLabels.forEach((l, i) => {
    if (i % labelStep === 0 || i === n - 1) {
      ctx.fillText(l, pad.left + i * step + step/2, pad.top + iH + 16);
    }
  });
}

function attachSwipe(canvasId, state, rangeElId) {
  const canvas = document.getElementById(canvasId);
  if (!canvas) return;

  // Touch
  canvas.addEventListener('touchstart', e => {
    state.dragging = true;
    state.startX = e.touches[0].clientX;
    state.startOffset = state.offset;
  }, { passive: true });

  canvas.addEventListener('touchmove', e => {
    if (!state.dragging) return;
    const dx = e.touches[0].clientX - state.startX;
    const cssW = canvas.clientWidth || 340;
    const pxPerBar = cssW / Math.min(WIN, state.labels.length);
    const delta = Math.round(-dx / pxPerBar);
    const total = state.labels.length;
    const win = Math.min(WIN, total);
    state.offset = Math.max(0, Math.min(state.startOffset + delta, total - win));
    drawChart(canvasId, state, rangeElId);
  }, { passive: true });

  canvas.addEventListener('touchend', () => { state.dragging = false; });

  // Mouse (desktop)
  canvas.addEventListener('mousedown', e => {
    state.dragging = true;
    state.startX = e.clientX;
    state.startOffset = state.offset;
  });
  window.addEventListener('mousemove', e => {
    if (!state.dragging) return;
    const dx = e.clientX - state.startX;
    const cssW = canvas.clientWidth || 340;
    const pxPerBar = cssW / Math.min(WIN, state.labels.length);
    const delta = Math.round(-dx / pxPerBar);
    const total = state.labels.length;
    const win = Math.min(WIN, total);
    state.offset = Math.max(0, Math.min(state.startOffset + delta, total - win));
    drawChart(canvasId, state, rangeElId);
  });
  window.addEventListener('mouseup', () => { state.dragging = false; });
}

function drawCharts() {
  // Build data
  const daily = buildRollingAvgHistory();
  chartState.daily.labels = daily.labels;
  chartState.daily.values = daily.values;
  chartState.daily.offset = Math.max(0, daily.labels.length - WIN);

  const intv = buildIntervalHistory();
  chartState.interval.labels = intv.labels;
  chartState.interval.values = intv.values;
  chartState.interval.offset = Math.max(0, intv.labels.length - WIN);

  // Draw ‚Äî use requestAnimationFrame to ensure canvas has layout dimensions
  requestAnimationFrame(() => {
    drawChart('chartDaily', chartState.daily, 'chartRangeLabel');
    drawChart('chartInterval', chartState.interval, null);
    attachSwipe('chartDaily', chartState.daily, 'chartRangeLabel');
    attachSwipe('chartInterval', chartState.interval, null);
  });
}

// Legacy stubs (called nowhere but kept for safety)
function onSliderChange() {}

function exportData() {
  const blob = new Blob([JSON.stringify(packs, null, 2)], {type:'application/json'});
  const a = document.createElement('a');
  a.href = URL.createObjectURL(blob);
  a.download = `cigtracker_${new Date().toISOString().slice(0,10)}.json`;
  a.click();
}

function importData(e) {
  const file = e.target.files[0];
  if (!file) return;
  const r = new FileReader();
  r.onload = ev => {
    try {
      const data = JSON.parse(ev.target.result);
      if (Array.isArray(data)) {
        packs = data;
        save(); update();
        showToast(t('toast_imported'));
      }
    } catch { showToast(t('toast_invalid')); }
  };
  r.readAsText(file);
}

// ===================== TOAST =====================
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 2500);
}


// ===================== SETTINGS =====================
function openSettings() {
  document.getElementById('settingsPanel').classList.add('open');
  renderThresholdGrid();
  updateLangTiles();
  updateDeletePreview();
}

function closeSettings() {
  document.getElementById('settingsPanel').classList.remove('open');
}

function updateLangTiles() {
  document.querySelectorAll('.lang-tile').forEach(b => b.classList.remove('active'));
  const tile = document.getElementById('ltile-' + currentLang);
  if (tile) tile.classList.add('active');
}

// Threshold grid
const ZONE_DEFS = [
  { key: 't1', color: '#ffd700',  labelKey: 's_zone1' },
  { key: 't2', color: '#52b788',  labelKey: 's_zone2' },
  { key: 't3', color: '#ff9800',  labelKey: 's_zone3' },
  { key: 't4', color: '#ff2222',  labelKey: 's_zone4' },
  { key: 't5', color: '#7b00d4',  labelKey: 's_zone5' },
];

function renderThresholdGrid() {
  const grid = document.getElementById('thresholdGrid');
  grid.innerHTML = '';
  ZONE_DEFS.forEach(z => {
    const row = document.createElement('div');
    row.className = 'threshold-row';
    row.innerHTML = `
      <div class="threshold-swatch" style="color:${z.color};background:${z.color}22;"></div>
      <div class="threshold-label">${t(z.labelKey)}</div>
      <input class="threshold-input" type="number" min="1" max="200"
             id="thresh-${z.key}" value="${thresholds[z.key]}">
    `;
    grid.appendChild(row);
  });
}

function applyThresholds() {
  const newT = {};
  ZONE_DEFS.forEach(z => {
    const v = parseInt(document.getElementById('thresh-' + z.key).value);
    newT[z.key] = isNaN(v) || v < 1 ? DEFAULT_THRESHOLDS[z.key] : v;
  });
  // Enforce ascending order
  const keys = ['t1','t2','t3','t4','t5'];
  for (let i = 1; i < keys.length; i++) {
    if (newT[keys[i]] <= newT[keys[i-1]]) newT[keys[i]] = newT[keys[i-1]] + 1;
  }
  thresholds = newT;
  localStorage.setItem(THRESH_KEY, JSON.stringify(thresholds));
  renderThresholdGrid();
  updateLegendPills();
  update();
  showToast(t('toast_thresh_saved'));
}

function resetThresholds() {
  thresholds = { ...DEFAULT_THRESHOLDS };
  localStorage.removeItem(THRESH_KEY);
  renderThresholdGrid();
  updateLegendPills();
  update();
  showToast(t('toast_thresh_reset'));
}

function updateLegendPills() {
  const { t1, t2, t3, t4, t5 } = thresholds;
  const pills = document.querySelectorAll('.legend-pill');
  const vals = [
    { val: '<' + t1, color: '#ffd700' },
    { val: t1,       color: '#56cfe1' },
    { val: t2,       color: '#52b788' },
    { val: t2 + 1,   color: '#a8c060' },
    { val: t3,       color: '#ff9800' },
    { val: t3 + 1,   color: '#ff6600' },
    { val: t4,       color: '#ff2222' },
    { val: t4 + 1,   color: '#aa00cc' },
    { val: t5 + '+', color: '#7b00d4' },
  ];
  pills.forEach((p, i) => {
    if (vals[i]) {
      p.textContent = vals[i].val;
      p.style.borderColor = vals[i].color;
      p.style.color = vals[i].color;
    }
  });
}

// Delete date range
function updateDeletePreview() {
  const from = document.getElementById('deleteFrom').value;
  const to   = document.getElementById('deleteTo').value;
  const prev = document.getElementById('deleteRangePreview');
  if (!from || !to) { prev.textContent = ''; return; }
  const fromTs = new Date(from).setHours(0,0,0,0);
  const toTs   = new Date(to).setHours(23,59,59,999);
  if (fromTs > toTs) { prev.textContent = t('s_invalid_range'); return; }
  const count = packs.filter(p => p.ts >= fromTs && p.ts <= toTs).length;
  prev.textContent = count + ' ' + t('s_packs_in_range');
}

// Wire up date inputs
document.addEventListener('DOMContentLoaded', () => {
  document.getElementById('deleteFrom').addEventListener('change', updateDeletePreview);
  document.getElementById('deleteTo').addEventListener('change', updateDeletePreview);
});

function deleteRange() {
  const from = document.getElementById('deleteFrom').value;
  const to   = document.getElementById('deleteTo').value;
  if (!from || !to) { showToast(t('s_pick_dates')); return; }
  const fromTs = new Date(from).setHours(0,0,0,0);
  const toTs   = new Date(to).setHours(23,59,59,999);
  if (fromTs > toTs) { showToast(t('s_invalid_range')); return; }
  const before = packs.length;
  packs = packs.filter(p => p.ts < fromTs || p.ts > toTs);
  const removed = before - packs.length;
  save(); update();
  document.getElementById('deleteRangePreview').textContent = '';
  showToast(removed + ' ' + t('toast_range_deleted'));
}

function fullReset() {
  if (!confirm(t('confirm_full_reset'))) return;
  packs = [];
  thresholds = { ...DEFAULT_THRESHOLDS };
  localStorage.removeItem(STORE_KEY);
  localStorage.removeItem(THRESH_KEY);
  updateLegendPills();
  update();
  showToast(t('toast_full_reset'));
  closeSettings();
}

// ===================== INIT =====================
currentLang = detectLang();
load();
setLang(currentLang);
update();

// Auto-update every minute for time-based stats
setInterval(update, 60000);

// Register service worker for offline PWA support
if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('./sw.js')
    .then(reg => {
      // If there's a waiting SW (new version), activate it immediately
      if (reg.waiting) reg.waiting.postMessage({ type: 'SKIP_WAITING' });
      reg.addEventListener('updatefound', () => {
        const nw = reg.installing;
        nw.addEventListener('statechange', () => {
          if (nw.state === 'installed' && navigator.serviceWorker.controller) {
            nw.postMessage({ type: 'SKIP_WAITING' });
          }
        });
      });
    })
    .catch(() => {}); // silently fail if SW not supported
}
</script>
</body>
</html>
